# 🧪 دليل الاختبار الشامل - نظام الإسنادات والمراجعين

## 🎯 ما تم تحديثه

### التحديث الأخير ⭐:
**جلب المستخدمين عند فتح Modal (النافذة المنبثقة)**

#### قبل:
```
عند فتح التذكرة → يجلب المستخدمين
```

#### الآن:
```
عند الضغط على [+] → يجلب المستخدمين ⭐
```

**الفائدة**: 
- أسرع في تحميل التذكرة
- يجلب المستخدمين فقط عند الحاجة
- يظهر أحدث قائمة مستخدمين

---

## 🧪 خطوات الاختبار

### 1. أعد تحميل الصفحة:
```bash
اضغط Ctrl+Shift+R (لمسح الـ cache)
```

### 2. افتح Console للمراقبة:
```bash
اضغط F12
اذهب إلى تبويب Console
```

### 3. افتح تذكرة:
```
اضغط على أي تذكرة في Kanban
```

**المتوقع في Console**:
```
✅ يجب ألا ترى "جاري جلب المستخدمين" هنا
✅ فقط logs الإسنادات والمراجعين
```

---

## 🎯 اختبار إضافة مستخدم مُسند

### الخطوة 1: اضغط [+] في قسم المستخدمين المُسندين

**المتوقع في Console**:
```
🔓 تم فتح Modal - جلب المستخدمين...
🔍 جاري جلب المستخدمين من API...
📡 استجابة API: 200
📦 البيانات المستلمة: {success: true, data: Array(10), ...}
👥 عدد المستخدمين: 10
👥 المستخدمين: [{...}, {...}, ...]
```

### الخطوة 2: تحقق من القائمة المنسدلة

**المتوقع**:
```
┌─────────────────────────────────────┐
│ إضافة مستخدم مُسند                 │
├─────────────────────────────────────┤
│ المستخدم:                           │
│ ┌─────────────────────────────────┐ │
│ │ اختر مستخدم              ▼     │ │
│ │ ├─ Admin User - Super Admin     │ │ ✅ يظهر
│ │ ├─ أحمد محمد - Developer        │ │ ✅ يظهر
│ │ ├─ سارة علي - Designer          │ │ ✅ يظهر
│ │ └─ ... (المزيد)                 │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### الخطوة 3: اختر مستخدم

**الإجراء**:
1. اختر مستخدم من القائمة
2. أضف دور (اختياري): مثل "مطور رئيسي"
3. أضف ملاحظات (اختياري): مثل "مسؤول عن الواجهة"

### الخطوة 4: اضغط "إضافة"

**المتوقع**:
```
✅ يتم إرسال POST /api/ticket-assignments
✅ يتم إضافة المستخدم للقائمة
✅ يظهر المستخدم في قسم "المستخدمين المُسندين"
```

**الشكل المتوقع**:
```
┌────────────────────────────────────┐
│ 👥 المستخدمين المُسندين (1)   [+]│
├────────────────────────────────────┤
│ 👤 أحمد محمد - مطور رئيسي     [×]│
└────────────────────────────────────┘
```

---

## 🎯 اختبار إضافة مراجع

### الخطوة 1: اضغط [+] في قسم المراجعين

**المتوقع في Console**:
```
🔓 تم فتح Modal - جلب المستخدمين...
🔍 جاري جلب المستخدمين من API...
📡 استجابة API: 200
👥 عدد المستخدمين: 10
```

### الخطوة 2: تحقق من القائمة المنسدلة

**المتوقع**:
```
┌─────────────────────────────────────┐
│ إضافة مراجع                         │
├─────────────────────────────────────┤
│ المراجع:                            │
│ ┌─────────────────────────────────┐ │
│ │ اختر مراجع                ▼     │ │
│ │ ├─ محمد خالد - Manager          │ │ ✅ يظهر
│ │ ├─ فاطمة أحمد - Tech Lead       │ │ ✅ يظهر
│ │ └─ ... (المزيد)                 │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### الخطوة 3: اختر مراجع

**الإجراء**:
1. اختر مراجع من القائمة
2. أضف ملاحظات المراجعة (اختياري): مثل "مراجعة الكود والتصميم"

### الخطوة 4: اضغط "إضافة"

**المتوقع**:
```
✅ يتم إرسال POST /api/ticket-reviewers
✅ يتم إضافة المراجع للقائمة
✅ يظهر المراجع في قسم "المراجعين"
```

**الشكل المتوقع**:
```
┌────────────────────────────────────┐
│ 🛡️ المراجعين (1)              [+]│
├────────────────────────────────────┤
│ 👤 محمد خالد                       │
│ ⏸ معلق                             │
│ [بدء المراجعة] [تخطي]         [×]│
└────────────────────────────────────┘
```

---

## 🎯 اختبار تحديث حالة المراجعة

### الخطوة 1: اضغط "بدء المراجعة"

**المتوقع**:
```
✅ يتم إرسال PUT /api/ticket-reviewers/{id}/status
✅ تتغير الحالة إلى "قيد المراجعة"
✅ يظهر زر "إكمال المراجعة"
```

**الشكل المتوقع**:
```
┌────────────────────────────────────┐
│ 👤 محمد خالد                       │
│ ⏳ قيد المراجعة                    │
│ [إكمال المراجعة] [تخطي]       [×]│
└────────────────────────────────────┘
```

### الخطوة 2: اضغط "إكمال المراجعة"

**المتوقع**:
```
✅ يتم إرسال PUT /api/ticket-reviewers/{id}/status
✅ تتغير الحالة إلى "مكتمل"
✅ تختفي الأزرار
```

**الشكل المتوقع**:
```
┌────────────────────────────────────┐
│ 👤 محمد خالد                       │
│ ✓ مكتمل                            │
│                                [×]│
└────────────────────────────────────┘
```

---

## 🎯 اختبار الحذف

### حذف مستخدم مُسند:

**الإجراء**:
1. اضغط [×] بجانب المستخدم
2. أكد الحذف

**المتوقع**:
```
✅ يظهر تأكيد: "هل أنت متأكد من حذف هذا المستخدم المُسند؟"
✅ يتم إرسال DELETE /api/ticket-assignments/{id}
✅ يختفي المستخدم من القائمة
```

### حذف مراجع:

**الإجراء**:
1. اضغط [×] بجانب المراجع
2. أكد الحذف

**المتوقع**:
```
✅ يظهر تأكيد: "هل أنت متأكد من حذف هذا المراجع؟"
✅ يتم إرسال DELETE /api/ticket-reviewers/{id}
✅ يختفي المراجع من القائمة
```

---

## 📊 سيناريو اختبار كامل

### السيناريو: إضافة 2 مستخدمين مُسندين و 1 مراجع

#### 1. افتح تذكرة:
```
التذكرة #123
├── 👥 المستخدمين المُسندين (0) [+]
└── 🛡️ المراجعين (0) [+]
```

#### 2. أضف مستخدم مُسند #1:
```
[+] → اختر "أحمد محمد" → دور: "مطور" → إضافة
```

**النتيجة**:
```
التذكرة #123
├── 👥 المستخدمين المُسندين (1) [+]
│   └── 👤 أحمد محمد - مطور [×]
└── 🛡️ المراجعين (0) [+]
```

#### 3. أضف مستخدم مُسند #2:
```
[+] → اختر "سارة علي" → دور: "مصممة" → إضافة
```

**النتيجة**:
```
التذكرة #123
├── 👥 المستخدمين المُسندين (2) [+]
│   ├── 👤 أحمد محمد - مطور [×]
│   └── 👤 سارة علي - مصممة [×]
└── 🛡️ المراجعين (0) [+]
```

#### 4. أضف مراجع:
```
[+] → اختر "محمد خالد" → ملاحظات: "مراجعة الكود" → إضافة
```

**النتيجة**:
```
التذكرة #123
├── 👥 المستخدمين المُسندين (2) [+]
│   ├── 👤 أحمد محمد - مطور [×]
│   └── 👤 سارة علي - مصممة [×]
└── 🛡️ المراجعين (1) [+]
    └── 👤 محمد خالد
        ⏸ معلق
        [بدء المراجعة] [تخطي] [×]
```

#### 5. ابدأ المراجعة:
```
اضغط "بدء المراجعة"
```

**النتيجة**:
```
└── 🛡️ المراجعين (1) [+]
    └── 👤 محمد خالد
        ⏳ قيد المراجعة
        [إكمال المراجعة] [تخطي] [×]
```

#### 6. أكمل المراجعة:
```
اضغط "إكمال المراجعة"
```

**النتيجة**:
```
└── 🛡️ المراجعين (1) [+]
    └── 👤 محمد خالد
        ✓ مكتمل
        [×]
```

---

## ✅ نقاط التحقق

### في Console (F12):

#### عند فتح Modal:
- ✅ `🔓 تم فتح Modal - جلب المستخدمين...`
- ✅ `📡 استجابة API: 200`
- ✅ `👥 عدد المستخدمين: 10` (أو أكثر)

#### عند إضافة مستخدم:
- ✅ لا توجد أخطاء
- ✅ المستخدم يظهر في القائمة فوراً

#### عند تحديث حالة:
- ✅ الحالة تتغير فوراً
- ✅ الأزرار تتحدث حسب الحالة

---

## 🐛 استكشاف الأخطاء

### المشكلة: القائمة المنسدلة فارغة

**التحقق**:
1. افتح Console (F12)
2. ابحث عن "عدد المستخدمين"
3. إذا كان 0:
   - تحقق من API: `GET http://localhost:3000/api/users`
   - تحقق من Token في localStorage
   - تحقق من أن السيرفر يعمل

### المشكلة: خطأ 401 (Unauthorized)

**الحل**:
1. سجل خروج
2. سجل دخول مرة أخرى
3. جرب مرة أخرى

### المشكلة: لا يتم إضافة المستخدم

**التحقق**:
1. افتح Network tab في Console
2. ابحث عن request إلى `/api/ticket-assignments`
3. تحقق من response
4. إذا كان 500: تحقق من logs السيرفر

---

## 🎊 النتيجة المتوقعة

بعد اجتياز جميع الاختبارات:

✅ **جلب المستخدمين يعمل** عند فتح Modal
✅ **إضافة مستخدمين مُسندين يعمل**
✅ **إضافة مراجعين يعمل**
✅ **تحديث حالة المراجعة يعمل**
✅ **حذف يعمل**
✅ **الواجهة جميلة ومتجاوبة**

**النظام جاهز للاستخدام! 🚀**
