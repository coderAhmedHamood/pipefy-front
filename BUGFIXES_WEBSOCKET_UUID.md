# ๐ ุฅุตูุงุญ ุงูุฃุฎุทุงุก - WebSocket ู UUID

## ุชุงุฑูุฎ ุงูุฅุตูุงุญ
**ุงูุชุงุฑูุฎ:** 2 ููุงูุฑ 2026

---

## ุงููุดููุฉ ุงูุฃููู: WebSocket auth error

### โ ุงูุฎุทุฃ
```
WebSocket auth error: db.query is not a function
```

### ๐ ุงูุชุดุฎูุต
- ุงูููุฏ ูู `api/services/websocketService.js` ูุงู ูุณุชุฎุฏู `db.query()`
- ููู `db` ุงููุณุชูุฑุฏ ูู `../config/database` ูู object ูุญุชูู ุนูู `pool`
- ุงูุทุฑููุฉ ุงูุตุญูุญุฉ ูู `db.pool.query()`

### โ ุงูุญู
ุชู ุชุญุฏูุซ ุฌููุน ุงุณุชุฏุนุงุกุงุช `db.query` ุฅูู `db.pool.query` ูู ุงูููู:
- ุงูุณุทุฑ 22: ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
- ุงูุณุทุฑ 50: ุงูุชุญูู ูู ุฑุจุท ุงููุณุชุฎุฏู ุจุงูุนูููุฉ
- ุงูุณุทุฑ 196: ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `api/services/websocketService.js`

---

## ุงููุดููุฉ ุงูุซุงููุฉ: UUID Validation Error

### โ ุงูุฎุทุฃ
```
ุฎุทุฃ ูู ุฌูุจ ุงูุชุฐุงูุฑ ุญุณุจ ุงููุฑุงุญู: error: invalid input syntax for type uuid: "1767383034182"
```

### ๐ ุงูุชุดุฎูุต
- ุงูุฑูู `"1767383034182"` ูู timestamp (13 ุฑูู - milliseconds)
- ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุชููุน UUID ุจุชูุณูู: `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
- ูุงู ูุชู ุฅุฑุณุงู stage IDs ุบูุฑ ุตุญูุญุฉ ูู ุงูู Frontend ุฃู ูุฌูุฏ ูุฑุงุญู ูุฏููุฉ ุจู IDs ุฎุงุทุฆุฉ

### โ ุงูุญู
ุชู ุฅุถุงูุฉ validation ูู `api/controllers/TicketController.js`:

```javascript
// ุงูุชุญูู ูู ุตุญุฉ ุชูุณูู UUID ููู stage ID
const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
const invalidStageIds = stageIdsArray.filter(id => !uuidRegex.test(id));

if (invalidStageIds.length > 0) {
  console.warn('โ๏ธ Stage IDs ุบูุฑ ุตุญูุญุฉ (ููุณุช UUIDs):', invalidStageIds);
  return res.status(400).json({
    success: false,
    message: 'ุจุนุถ ูุนุฑูุงุช ุงููุฑุงุญู ุบูุฑ ุตุญูุญุฉ. ูุฌุจ ุฃู ุชููู UUIDs ุตุญูุญุฉ',
    invalid_ids: invalidStageIds
  });
}
```

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `api/controllers/TicketController.js` (ูุธููุฉ `getTicketsByStages`)

---

## ๐ฏ ุงููุชูุฌุฉ

### ูุจู ุงูุฅุตูุงุญ:
- โ ุฃุฎุทุงุก WebSocket ูุชูุฑุฑุฉ ูู Console
- โ ูุดู ุฌูุจ ุงูุชุฐุงูุฑ ุนูุฏ ุงุณุชุฎุฏุงู stage IDs ุบูุฑ ุตุญูุญุฉ
- โ ุฑุณุงุฆู ุฎุทุฃ ุบูุฑ ูุงุถุญุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ WebSocket ูุนูู ุจุดูู ุตุญูุญ
- โ Validation ููู ูู stage IDs
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุชุญุฏุฏ ุงููุดููุฉ
- โ ุงููุธุงู ูุนูู ุจุดูู ูุณุชูุฑ

---

## ๐ ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงููุทููุจุฉ

ูุชุทุจูู ุงูุฅุตูุงุญุงุช:

```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูู Backend
cd api
npm restart
# ุฃู
node server.js
```

**ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุดุบูู Frontend** - ุงูุชุบููุฑุงุช ูู Backend ููุท

---

## ๐ ููุงุญุธุงุช

1. **ุงูุฃุฎุทุงุก ูู ุชุธูุฑ ุจุนุฏ ุงูุขู** ูู Console
2. **ูุง ุชุฃุซูุฑ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ** - ุงูุชุบููุฑุงุช ููุท ูู ุงูู validation
3. **ุชุญุณูู ุงูุฃุฏุงุก** - ุชูููู ุงูุฃุฎุทุงุก = ุชูููู ุงุณุชููุงู ุงูููุงุฑุฏ
4. **ุฃูุงู ุฃูุถู** - validation ูููุน ุฅุฏุฎุงู ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

ููุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู:

1. โ ุงูุชุญ ููุญุฉ ุงููุงูุจุงู
2. โ ุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก ูู Console
3. โ ุฌุฑุจ ููู ุงูุชุฐุงูุฑ ุจูู ุงููุฑุงุญู
4. โ ุชุฃูุฏ ูู ุนูู WebSocket (ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ)

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงูู

ุฅุฐุง ุฑุฃูุช ููุณ ุงูุฃุฎุทุงุก ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู:

1. ุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุดุบูู ุงูู Backend
2. ุงูุณุญ ุงูู cache ูู ุงููุชุตูุญ (Ctrl+Shift+Delete)
3. ุชุญูู ูู ุฃู ุฌููุน ุงููุฑุงุญู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง UUIDs ุตุญูุญุฉ:

```sql
-- ููุชุญูู ูู ุงููุฑุงุญู
SELECT id, name, process_id 
FROM stages 
WHERE id::text NOT ~ '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$';
```

ุฅุฐุง ูุฌุฏุช ูุฑุงุญู ุจู IDs ุบูุฑ ุตุญูุญุฉุ ูุฌุจ ุฅุตูุงุญูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

