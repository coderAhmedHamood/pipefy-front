# ูุธุงู ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ ูุงููุฑุงุฌุนุฉ - Assignment & Review Notifications System

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู ูููู ุจุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ุนูุฏ ุฅุณูุงุฏ ูุณุชุฎุฏููู ุฃู ูุฑุงุฌุนูู ุฅูู ุงูุชุฐุงูุฑุ ูุน ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ ูุงูุฑูุงุจุท ุงููุจุงุดุฑุฉ.

## ุงูููุฒุงุช ุงููุทุจูุฉ

### 1. ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ (User Assignment)
- **ุฅุดุนุงุฑ ููุฑู** ุนูุฏ ุฅุณูุงุฏ ูุณุชุฎุฏู ุฅูู ุชุฐูุฑุฉ
- **ูุนูููุงุช ุดุงููุฉ**: ุงุณู ุงููุณุชุฎุฏูุ ุฏูุฑ ุงูุฅุณูุงุฏุ ูู ูุงู ุจุงูุฅุณูุงุฏ
- **ุฑุงุจุท ูุจุงุดุฑ** ุฅูู ุงูุชุฐูุฑุฉ: `/tickets/{ticket_id}`

### 2. ุฅุดุนุงุฑุงุช ุงููุฑุงุฌุนุฉ (Reviewer Assignment)
- **ุฅุดุนุงุฑ ููุฑู** ุนูุฏ ุชุนููู ูุฑุงุฌุน ููุชุฐูุฑุฉ
- **ูุนูููุงุช ููุตูุฉ**: ุงุณู ุงููุฑุงุฌุนุ ููุงุญุธุงุช ุงููุฑุงุฌุนุฉุ ูู ูุงู ุจุงูุชุนููู
- **ุฑุงุจุท ูุจุงุดุฑ** ุฅูู ุงูุชุฐูุฑุฉ: `/tickets/{ticket_id}`

### 3. ุฅุดุนุงุฑุงุช ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ (Review Status Updates)
- **ุฅุดุนุงุฑ ุนูุฏ ุฅููุงู ุงููุฑุงุฌุนุฉ** ูุน ุงูุชูููู
- **ุฅุดุนุงุฑ ุฌูุงุนู** ูุฌููุน ุงููุณุชุฎุฏููู ุงููุฑุชุจุทูู ุจุงูุชุฐูุฑุฉ
- **ูุนูููุงุช ุงูุชูููู**: ุงุณู ุงููุฑุงุฌุนุ ุงูุชููููุ ุญุงูุฉ ุงููุฑุงุฌุนุฉ

## ุงูุจููุฉ ุงูุชูููุฉ

### 1. NotificationHelper (`utils/notificationHelper.js`)
```javascript
class NotificationHelper {
  // ุฅุฑุณุงู ุฅุดุนุงุฑ ุงูุฅุณูุงุฏ
  static async sendAssignmentNotification({
    assignedUserId,
    assignerUserId,
    ticketId,
    ticketTitle,
    role
  })

  // ุฅุฑุณุงู ุฅุดุนุงุฑ ุงููุฑุงุฌุนุฉ
  static async sendReviewerNotification({
    reviewerId,
    adderUserId,
    ticketId,
    ticketTitle,
    reviewNotes
  })

  // ุฅุฑุณุงู ุฅุดุนุงุฑ ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ
  static async sendReviewStatusUpdateNotification({
    ticketId,
    ticketTitle,
    reviewerId,
    reviewStatus,
    rate,
    notifyUserIds
  })

  // ุฌูุจ ุงููุณุชุฎุฏููู ุงููุฑุชุจุทูู ุจุงูุชุฐูุฑุฉ
  static async getTicketRelatedUserIds(ticketId, excludeUserId)
}
```

### 2. ุชุญุฏูุซ Controllers

#### TicketAssignmentController
```javascript
// ูู ุฏุงูุฉ assignUser
await NotificationHelper.sendAssignmentNotification({
  assignedUserId: user_id,
  assignerUserId: assigned_by,
  ticketId: ticket_id,
  ticketTitle: ticketTitle,
  role: role
});
```

#### TicketReviewerController
```javascript
// ูู ุฏุงูุฉ addReviewer
await NotificationHelper.sendReviewerNotification({
  reviewerId: reviewer_id,
  adderUserId: added_by,
  ticketId: ticket_id,
  ticketTitle: ticketTitle,
  reviewNotes: review_notes
});

// ูู ุฏุงูุฉ updateReviewStatus
if (review_status === 'completed' && rate) {
  await NotificationHelper.sendReviewStatusUpdateNotification({
    ticketId: reviewer.ticket_id,
    ticketTitle: ticketTitle,
    reviewerId: reviewer.reviewer_id,
    reviewStatus: review_status,
    rate: rate,
    notifyUserIds: relatedUserIds
  });
}
```

## ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

### 1. ุฅุดุนุงุฑ ุงูุฅุณูุงุฏ (`ticket_assigned`)
```json
{
  "title": "๐ ุชู ุฅุณูุงุฏู ุฅูู ุชุฐูุฑุฉ ุฌุฏูุฏุฉ",
  "message": "ุชู ุฅุณูุงุฏู ุฅูู ุงูุชุฐูุฑุฉ: \"ุนููุงู ุงูุชุฐูุฑุฉ\"\n๐ค ุงูุฏูุฑ: ูุทูุฑ\n๐ ุจูุงุณุทุฉ: ุงุณู ุงููุณุชุฎุฏู",
  "notification_type": "ticket_assigned",
  "action_url": "/tickets/ticket-id",
  "data": {
    "ticket_id": "uuid",
    "ticket_title": "ุนููุงู ุงูุชุฐูุฑุฉ",
    "assigned_by": "uuid",
    "assigned_by_name": "ุงุณู ุงููุณุชุฎุฏู",
    "role": "ูุทูุฑ"
  }
}
```

### 2. ุฅุดุนุงุฑ ุชุนููู ุงููุฑุงุฌุน (`ticket_review_assigned`)
```json
{
  "title": "๐ ุชู ุชุนูููู ููุฑุงุฌุน ูุชุฐูุฑุฉ",
  "message": "ุชู ุชุนูููู ููุฑุงุฌุน ููุชุฐูุฑุฉ: \"ุนููุงู ุงูุชุฐูุฑุฉ\"\n๐ ููุงุญุธุงุช: ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ\n๐ ุจูุงุณุทุฉ: ุงุณู ุงููุณุชุฎุฏู",
  "notification_type": "ticket_review_assigned",
  "action_url": "/tickets/ticket-id",
  "data": {
    "ticket_id": "uuid",
    "ticket_title": "ุนููุงู ุงูุชุฐูุฑุฉ",
    "added_by": "uuid",
    "added_by_name": "ุงุณู ุงููุณุชุฎุฏู",
    "review_notes": "ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ"
  }
}
```

### 3. ุฅุดุนุงุฑ ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ (`ticket_review_updated`)
```json
{
  "title": "๐ ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุฌุนุฉ",
  "message": "ุชู ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุฌุนุฉ ุงูุชุฐูุฑุฉ: \"ุนููุงู ุงูุชุฐูุฑุฉ\"\n๐ ุงููุฑุงุฌุน: ุงุณู ุงููุฑุงุฌุน\n๐ ุงูุญุงูุฉ: ููุชููุฉ\nโญ ุงูุชูููู: ููุชุงุฒ",
  "notification_type": "ticket_review_updated",
  "action_url": "/tickets/ticket-id",
  "data": {
    "ticket_id": "uuid",
    "ticket_title": "ุนููุงู ุงูุชุฐูุฑุฉ",
    "reviewer_id": "uuid",
    "reviewer_name": "ุงุณู ุงููุฑุงุฌุน",
    "review_status": "completed",
    "rate": "ููุชุงุฒ"
  }
}
```

## API Endpoints ุงููุญุฏุซุฉ

### 1. ุฅุณูุงุฏ ูุณุชุฎุฏู
```http
POST /api/ticket-assignments
Content-Type: application/json
Authorization: Bearer {token}

{
  "ticket_id": "uuid",
  "user_id": "uuid",
  "role": "ูุทูุฑ",
  "notes": "ููุงุญุธุงุช ุงูุฅุณูุงุฏ"
}
```
**ุงูุชุญุฏูุซ**: ูุฑุณู ุฅุดุนุงุฑุงู ุชููุงุฆูุงู ูููุณุชุฎุฏู ุงูููุณูุฏ

### 2. ุฅุถุงูุฉ ูุฑุงุฌุน
```http
POST /api/ticket-reviewers
Content-Type: application/json
Authorization: Bearer {token}

{
  "ticket_id": "uuid",
  "reviewer_id": "uuid",
  "review_notes": "ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ"
}
```
**ุงูุชุญุฏูุซ**: ูุฑุณู ุฅุดุนุงุฑุงู ุชููุงุฆูุงู ูููุฑุงุฌุน

### 3. ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุฌุนุฉ
```http
PUT /api/ticket-reviewers/{id}/status
Content-Type: application/json
Authorization: Bearer {token}

{
  "review_status": "completed",
  "rate": "ููุชุงุฒ",
  "review_notes": "ุชู ุฅููุงู ุงููุฑุงุฌุนุฉ ุจูุฌุงุญ"
}
```
**ุงูุชุญุฏูุซ**: ูุฑุณู ุฅุดุนุงุฑุงุช ูุฌููุน ุงููุณุชุฎุฏููู ุงููุฑุชุจุทูู ุนูุฏ ุงูุฅููุงู ูุน ุงูุชูููู

## ุงูุงุฎุชุจุงุฑ

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
```bash
# ูู ูุฌูุฏ api
node test-assignment-notifications.js
```

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ
1. โ **ุชุณุฌูู ุงูุฏุฎูู** ูุงูุญุตูู ุนูู ุงูุชููู
2. โ **ุฌูุจ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ** (ุชุฐุงูุฑ ููุณุชุฎุฏููู)
3. โ **ุงุฎุชุจุงุฑ ุฅุณูุงุฏ ูุณุชุฎุฏู** ูุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
4. โ **ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุฑุงุฌุน** ูุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
5. โ **ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ** ูุน ุงูุชูููู ูุงูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช
6. โ **ูุญุต ุงูุฅุดุนุงุฑุงุช** ููุชุฃูุฏ ูู ุงูุฅุฑุณุงู ุงูุตุญูุญ
7. โ **ุชูุธูู ุงูุจูุงูุงุช** ุจุนุฏ ุงูุงุฎุชุจุงุฑ

### ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ
```
๐ ุชู ุฅูุฌุงุฒ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุจูุฌุงุญ!
โ ูุธุงู ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ ูุงููุฑุงุฌุนุฉ ูุนูู ุจุดูู ุตุญูุญ

๐ ุงูุฅุญุตุงุฆูุงุช:
- โ ุฅุดุนุงุฑ ุงูุฅุณูุงุฏ: ุชู ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู
- โ ุฅุดุนุงุฑ ุชุนููู ุงููุฑุงุฌุน: ุชู ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู  
- โ ุฅุดุนุงุฑ ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ: ุชู ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู
- โ ุงูุฑูุงุจุท: /tickets/{ticket_id} ุชุนูู ุจุดูู ุตุญูุญ
```

## ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### 1. ูููุงุช ุฌุฏูุฏุฉ
- `utils/notificationHelper.js` - ูุณุงุนุฏ ุงูุฅุดุนุงุฑุงุช
- `test-assignment-notifications.js` - ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
- `ASSIGNMENT_NOTIFICATIONS_SYSTEM.md` - ูุฐุง ุงูุชูุซูู

### 2. ูููุงุช ูุญุฏุซุฉ
- `controllers/TicketAssignmentController.js` - ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ
- `controllers/TicketReviewerController.js` - ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุงููุฑุงุฌุนุฉ

## ุงูุงุณุชุฎุฏุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### ุฌูุจ ุงูุฅุดุนุงุฑุงุช
```javascript
// ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู ุงูุญุงูู
const response = await fetch('/api/notifications/user/{user_id}', {
  headers: { Authorization: `Bearer ${token}` }
});

const notifications = response.data.notifications;

// ููุชุฑุฉ ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ ูุงููุฑุงุฌุนุฉ
const assignmentNotifications = notifications.filter(n => 
  n.notification_type === 'ticket_assigned'
);

const reviewNotifications = notifications.filter(n => 
  ['ticket_review_assigned', 'ticket_review_updated'].includes(n.notification_type)
);
```

### ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
```jsx
// ูููู ุนุฑุถ ุงูุฅุดุนุงุฑ
function NotificationItem({ notification }) {
  const handleClick = () => {
    // ุงูุงูุชูุงู ุฅูู ุงูุชุฐูุฑุฉ
    window.location.href = notification.action_url;
  };

  return (
    <div className="notification-item" onClick={handleClick}>
      <h4>{notification.title}</h4>
      <p>{notification.message}</p>
      <small>{new Date(notification.created_at).toLocaleString('ar')}</small>
    </div>
  );
}
```

## ุงููููุฒุงุช

### โ ุงููุฒุงูุง
- **ุฅุดุนุงุฑุงุช ููุฑูุฉ**: ูุชู ุงูุฅุฑุณุงู ููุฑ ุญุฏูุซ ุงูุฅุฌุฑุงุก
- **ูุนูููุงุช ุดุงููุฉ**: ุชูุงุตูู ูุงููุฉ ุนู ุงูุฅุฌุฑุงุก ูุงููุณุชุฎุฏููู
- **ุฑูุงุจุท ูุจุงุดุฑุฉ**: ุงูุชูุงู ุณุฑูุน ุฅูู ุงูุชุฐูุฑุฉ ุงููุนููุฉ
- **ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ**: ูุตูุต ูุชูุณูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- **ูุธุงู ุขูู**: ูุง ููุดู ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ ุนูุฏ ุฎุทุฃ ูู ุงูุฅุดุนุงุฑ
- **ูุงุจููุฉ ุงูุชูุณุน**: ุณูููุฉ ุฅุถุงูุฉ ุฃููุงุน ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ

### ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ
- ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฅุดุนุงุฑุงุช ุงูุฏูุน (Push Notifications)
- ุชุฎุตูุต ุชูุถููุงุช ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏููู
- ุฅุดุนุงุฑุงุช ุงูููุช ุงููุนูู (Real-time)
- ุชุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุชุดุงุจูุฉ

## ุงูุฃูุงู ูุงูุฃุฏุงุก

### ุงูุฃูุงู
- โ **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช**: ููุท ุงููุฎูููู ูููููู ุงูุฅุณูุงุฏ
- โ **ุญูุงูุฉ ุงูุจูุงูุงุช**: ุนุฏู ุชุณุฑูุจ ูุนูููุงุช ุญุณุงุณุฉ
- โ **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช**: ููุชุฑุฉ ุงููุฏุฎูุงุช

### ุงูุฃุฏุงุก
- โ **ูุนุงููุงุช ูููุตูุฉ**: ุงูุฅุดุนุงุฑุงุช ูุง ุชุคุซุฑ ุนูู ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ุชุฌูุจ ูุดู ุงูุนูููุงุช ุจุณุจุจ ุฃุฎุทุงุก ุงูุฅุดุนุงุฑุงุช
- โ **ุงุณุชุนูุงูุงุช ูุญุณูุฉ**: ุฌูุจ ุงููุนูููุงุช ุจููุงุกุฉ

## ุงูุฏุนู ุงูููู

### ุงููุดุงูู ุงูุดุงุฆุนุฉ

#### 1. ูุง ุชุตู ุงูุฅุดุนุงุฑุงุช
- **ุงูุณุจุจ**: ุฎุทุฃ ูู ุงูุงุชุตุงู ุฃู ุงูุตูุงุญูุงุช
- **ุงูุญู**: ุชุญูู ูู logs ุงูุฎุงุฏู ูุตูุงุญูุงุช ุงููุณุชุฎุฏู

#### 2. ุฑูุงุจุท ุงูุฅุดุนุงุฑุงุช ูุง ุชุนูู
- **ุงูุณุจุจ**: ุชูุณูู ุฎุงุทุฆ ููุฑุงุจุท
- **ุงูุญู**: ุชุฃูุฏ ูู ุชูุณูู `/tickets/{ticket_id}`

#### 3. ุฅุดุนุงุฑุงุช ููุฑุฑุฉ
- **ุงูุณุจุจ**: ุชูุฑุงุฑ ูู ุงูุนูููุงุช
- **ุงูุญู**: ุชุญูู ูู ููุทู ุงูุชุญูู ูู ุงููุฌูุฏ

### ุณุฌู ุงูุชุบููุฑุงุช

#### ุงูุฅุตุฏุงุฑ 1.0.0 (ุงูููู)
- โ ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ุงูุฅุณูุงุฏ
- โ ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ุงููุฑุงุฌุนุฉ
- โ ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุชุญุฏูุซ ุงููุฑุงุฌุนุฉ
- โ ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ
- โ ุฑูุงุจุท ูุจุงุดุฑุฉ ููุชุฐุงูุฑ
- โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ**: ูุฑูู ุชุทููุฑ Pipefy  
**ุงูุชุงุฑูุฎ**: ุฃูุชูุจุฑ 2024  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุฅูุชุงุฌู
