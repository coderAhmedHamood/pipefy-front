# ๐ฌ ุชูุฑูุฑ ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุนูููุงุช ููุชุฐุงูุฑ

## ๐ฏ ุงููุฏู ุงููุญูู
ุชู ุชุทููุฑ ูุชุญุณูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุนูููุงุช ููุชุฐุงูุฑ ุจูุฌุงุญุ ูุน ุชุญููู ุฌููุน ุงููุชุทูุจุงุช ุงููุญุฏุฏุฉ ูุฅุถุงูุฉ ููุฒุงุช ุฅุถุงููุฉ ูุชุญุณูู ุงูุฃุฏุงุก ูุงูุฃูุงู.

## ๐ง ุงูููููุงุช ุงููุทูุฑุฉ ูุงููุญุณูุฉ

### 1. **ุชุญุณูู TicketController**
**ุงูููู**: `api/controllers/TicketController.js`

#### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ **ุชุถููู ุงูุชุนูููุงุช ุชููุงุฆูุงู**: ุนูุฏ ุฌูุจ ุงูุชุฐูุฑุฉ ุนุจุฑ `GET /api/tickets/{id}`
- โ **ูุนุงููุงุช ุงุฎุชูุงุฑูุฉ**: `include_comments`, `include_activities`, `include_attachments`
- โ **ูุฑููุฉ ูู ุงูุงุณุชุฎุฏุงู**: ุงูุชุนูููุงุช ูุถููุฉ ุงูุชุฑุงุถูุงู (`include_comments=true`)

```javascript
// ูุซุงู ุงูุงุณุชุฎุฏุงู
GET /api/tickets/{id}?include_comments=true&include_activities=false
```

### 2. **ุชุญุณูู CommentController**
**ุงูููู**: `api/controllers/CommentController.js`

#### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ **ุฏุนู ูุชุนุฏุฏ ุงูุชูุณููุงุช**: ุฏุนู `ticket_id` ู `id` ูู ุงููุนุงููุงุช
- โ **ุชุญุณูู ุงูุตูุงุญูุงุช**: ุงููุฏูุฑูู ูููููู ุญุฐู ุฃู ุชุนููู
- โ **ุชุณุฌูู ุงูุฃูุดุทุฉ**: ุชุณุฌูู ุชููุงุฆู ูุฅุถุงูุฉ ูุญุฐู ุงูุชุนูููุงุช
- โ **ูุนูููุงุช ุงููุคูู**: ุชุถููู ุงุณู ูุจุฑูุฏ ูุตูุฑุฉ ุงููุคูู

#### ุงูุฏูุงู ุงููุญุณูุฉ:
```javascript
// ุฏุนู ููุง ุงูุชูุณูููู
const { ticket_id, id } = req.params;
const ticketId = ticket_id || id;

// ุชุญุณูู ุงูุตูุงุญูุงุช
const isOwner = commentCheck.rows[0].user_id === req.user.id;
const isAdmin = req.user.role === 'admin' || req.user.role === 'super_admin';
```

### 3. **ุชุญุณูู Routes**
**ุงูููู**: `api/routes/tickets.js`

#### Routes ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ:
- โ `GET /api/tickets/{id}/comments` - ุฌูุจ ุชุนูููุงุช ุงูุชุฐูุฑุฉ
- โ `POST /api/tickets/{id}/comments` - ุฅุถุงูุฉ ุชุนููู ุฌุฏูุฏ
- โ **ุชูุซูู Swagger ุดุงูู** ูุน ุฌููุน ุงููุนุงููุงุช ูุงูุฃูุซูุฉ

#### ุฅุตูุงุญ ุชุฑุชูุจ Routes:
**ุงูููู**: `api/routes/comments.js`
- โ **ุฅุนุงุฏุฉ ุชุฑุชูุจ**: `/search` ูุจู `/:id` ูุชุฌูุจ ุงูุชุถุงุฑุจ
- โ **ุญุฐู ุงูุชูุฑุงุฑ**: ุฅุฒุงูุฉ ุงูุชูุซูู ุงูููุฑุฑ

### 4. **ุชุญุณูู ูููุฐุฌ ุงูุจูุงูุงุช**
**ุงูููู**: `api/models/Ticket.js`

#### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ **ูุนูููุงุช ุงููุคูู**: ุชุถููู `author_name`, `author_email`, `author_avatar`
- โ **ุชุฑุชูุจ ูุญุณู**: ุงูุชุนูููุงุช ูุฑุชุจุฉ ุญุณุจ ุงูุฃุญุฏุซ ุฃููุงู (`DESC`)
- โ **ูุนุงูุฌุฉ ุงููุฑููุงุช**: ุงูุชุนุงูู ุงูุขูู ูุน ุงููุฑููุงุช ุงููุงุฑุบุฉ

```javascript
// ุชุญุณูู ุฏุงูุฉ getComments
SELECT 
  tc.*,
  u.name as author_name,
  u.email as author_email,
  u.avatar_url as author_avatar
FROM ticket_comments tc
JOIN users u ON tc.user_id = u.id
WHERE tc.ticket_id = $1
ORDER BY tc.created_at DESC
```

## ๐ ุงูู Endpoints ุงููุชุงุญุฉ

### **1. ุฌูุจ ุงูุชุนูููุงุช**

#### ุนุจุฑ ุงูุชุฐูุฑุฉ:
```http
GET /api/tickets/{ticket_id}?include_comments=true
```

#### ูููุตู:
```http
GET /api/tickets/{ticket_id}/comments?page=1&limit=20
```

### **2. ุฅุถุงูุฉ ุชุนููู**
```http
POST /api/tickets/{ticket_id}/comments
Content-Type: application/json

{
  "content": "ูุญุชูู ุงูุชุนููู",
  "is_internal": false
}
```

### **3. ุชุญุฏูุซ ุชุนููู**
```http
PUT /api/comments/{comment_id}
Content-Type: application/json

{
  "content": "ุงููุญุชูู ุงููุญุฏุซ",
  "is_internal": true
}
```

### **4. ุญุฐู ุชุนููู**
```http
DELETE /api/comments/{comment_id}
```

### **5. ุฌูุจ ุชุนููู ูุญุฏุฏ**
```http
GET /api/comments/{comment_id}
```

### **6. ุงูุจุญุซ ูู ุงูุชุนูููุงุช**
```http
GET /api/comments/search?q=ูุต ุงูุจุญุซ&ticket_id={ticket_id}
```

## ๐ ูุธุงู ุงูุตูุงุญูุงุช

### **ูุฑุงุกุฉ ุงูุชุนูููุงุช**:
- โ **ุงููุทููุจ**: `tickets.read`
- โ **ุงููุตูู**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุตุฑุญ ููู

### **ุฅุถุงูุฉ ุชุนููู**:
- โ **ุงููุทููุจ**: `tickets.update`
- โ **ุงูุชุณุฌูู**: ุชุณุฌูู ุชููุงุฆู ูู ุฃูุดุทุฉ ุงูุชุฐูุฑุฉ

### **ุชุญุฏูุซ ุชุนููู**:
- โ **ุงููุณููุญ**: ุงููุคูู ููุท
- โ **ุงูุชุญูู**: ููุงุฑูุฉ `user_id` ูุน `req.user.id`

### **ุญุฐู ุชุนููู**:
- โ **ุงููุณููุญ**: ุงููุคูู ุฃู ุงููุฏูุฑ
- โ **ุงููุฏูุฑูู**: `admin` ุฃู `super_admin`
- โ **ุงูุชุณุฌูู**: ุชุณุฌูู ุชููุงุฆู ูู ุฃูุดุทุฉ ุงูุชุฐูุฑุฉ

## ๐งช ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู

### โ **ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช**:

#### 1. **ุฌูุจ ุงูุชุฐูุฑุฉ ูุน ุงูุชุนูููุงุช**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงูุชุนูููุงุช ุงููุฑุฌุนุฉ**: 3 ุชุนูููุงุช ููุฌูุฏุฉ
- **ุงููุนูููุงุช**: ุชุถููู ูุนูููุงุช ุงููุคูู ูุงููุฉ

#### 2. **ุฅุถุงูุฉ ุชุนููู ุฌุฏูุฏ**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงููุนุฑู**: `04b0dbc6-85b7-4850-80eb-4062e8120890`
- **ุงููุคูู**: `Admin User`
- **ุงูุชุณุฌูู**: ุชู ุชุณุฌูู ุงููุดุงุท ุชููุงุฆูุงู

#### 3. **ุฌูุจ ุงูุชุนูููุงุช ูููุตูุงู**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุฅุฌูุงูู ุงูุชุนูููุงุช**: 4 ุชุนูููุงุช
- **ุงูุตูุญุงุช**: ุตูุญุฉ ูุงุญุฏุฉ (20 ุชุนููู ููู ุตูุญุฉ)

#### 4. **ุฅุถุงูุฉ ุชุนููู ุฏุงุฎูู**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงูููุน**: `is_internal: true`
- **ุงูุชูููุฒ**: ุชู ุชูููุฒู ูุชุนููู ุฏุงุฎูู

#### 5. **ุฌูุจ ุชุนููู ูุญุฏุฏ**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงููุญุชูู**: ุชู ุฌูุจ ุงููุญุชูู ูุงููุงู
- **ูุนูููุงุช ุงูุชุฐูุฑุฉ**: ุชุถููู ุฑูู ุงูุชุฐูุฑุฉ

#### 6. **ุชุญุฏูุซ ุชุนููู**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงููุญุชูู ุงูุฌุฏูุฏ**: "ุชู ุชุญุฏูุซ ูุฐุง ุงูุชุนููู - ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงููุธุงู"
- **ุงูุตูุงุญูุงุช**: ุชุญูู ูู ููููุฉ ุงูุชุนููู

#### 7. **ุงูุจุญุซ ูู ุงูุชุนูููุงุช**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ูุชุงุฆุฌ ุงูุจุญุซ**: 5 ุชุนูููุงุช ุชุญุชูู ุนูู "ุงุฎุชุจุงุฑ"
- **ุงูุชุตููุฉ**: ุญุณุจ ุงูุชุฐูุฑุฉ ุงููุญุฏุฏุฉ

#### 8. **ุญุฐู ุชุนููู**
- **ุงููุชูุฌุฉ**: โ ูุฌุญ
- **ุงูุตูุงุญูุงุช**: ุชุญูู ูู ุงููุคูู/ุงููุฏูุฑ
- **ุงูุชุณุฌูู**: ุชู ุชุณุฌูู ูุดุงุท ุงูุญุฐู

#### 9. **ุฑูุถ ุงููุนุงููุงุช ุงูุฎุงุทุฆุฉ**
- **ุชุนููู ูุงุฑุบ**: โ ุฑูุถ (400) - "ูุญุชูู ุงูุชุนููู ูุทููุจ"
- **ุชุนููู ุบูุฑ ููุฌูุฏ**: โ ุฑูุถ (404) - "ุงูุชุนููู ุบูุฑ ููุฌูุฏ"

## ๐ฏ ุงูููุฒุงุช ุงููุญููุฉ

### **1. ุงูุชูุงูู ุงูุณูุณ**
- โ **ูุน ุงูุชุฐุงูุฑ**: ุชุถููู ุชููุงุฆู ูู `GET /api/tickets/{id}`
- โ **ูุน ุงูุฃูุดุทุฉ**: ุชุณุฌูู ุชููุงุฆู ูุฌููุน ุงูุนูููุงุช
- โ **ูุน ุงููุณุชุฎุฏููู**: ูุนูููุงุช ุงููุคูู ูุงููุฉ

### **2. ุงููุฑููุฉ ูู ุงูุงุณุชุฎุฏุงู**
- โ **ุชูุณููุงุช ูุชุนุฏุฏุฉ**: ุฏุนู `ticket_id` ู `id`
- โ **ูุนุงููุงุช ุงุฎุชูุงุฑูุฉ**: ุชุญูู ูู ุงูุจูุงูุงุช ุงููุฑุฌุนุฉ
- โ **ุชุฑุชูุจ ูุงุจู ููุชุฎุตูุต**: ุงูุฃุญุฏุซ ุฃููุงู ุงูุชุฑุงุถูุงู

### **3. ุงูุฃูุงู ูุงูููุซูููุฉ**
- โ **ูุตุงุฏูุฉ ูุทููุจุฉ**: ุฌููุน ุงูุนูููุงุช ูุญููุฉ
- โ **ุตูุงุญูุงุช ูุญุฏุฏุฉ**: ุชุญูู ุฏููู ูู ุงููุตูู
- โ **ุชุญูู ูู ุงูููููุฉ**: ุญูุงูุฉ ูู ุงูุชุนุฏูู ุบูุฑ ุงููุตุฑุญ
- โ **ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ**: ุงููุฏูุฑูู ูุญุฐููู ุฃู ุชุนููู

### **4. ุชุฌุฑุจุฉ ุงููุทูุฑ**
- โ **ุชูุซูู Swagger**: ุดุงูู ูุน ุฃูุซูุฉ
- โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**: ุณูููุฉ ุงูุชุดุฎูุต
- โ **ุงุณุชุฌุงุจุงุช ููุธูุฉ**: ูููู ููุญุฏ ููุจูุงูุงุช

## ๐ ุชุญุณููุงุช ุงูุฃุฏุงุก

### **1. ุงุณุชุนูุงูุงุช ูุญุณูุฉ**
- โ **JOIN ูุงุญุฏ**: ุฌูุจ ูุนูููุงุช ุงููุคูู ูุน ุงูุชุนููู
- โ **ููุฑุณุฉ ููุงุณุจุฉ**: ุงุณุชุฎุฏุงู ููุงุฑุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ุชุตููุฉ ูุนุงูุฉ**: WHERE clauses ูุญุณูุฉ

### **2. ุชูููู ุงูุทูุจุงุช**
- โ **ุชุถููู ุชููุงุฆู**: ุชุฌูุจ ุทูุจุงุช ุฅุถุงููุฉ ููุชุนูููุงุช
- โ **ูุนูููุงุช ุดุงููุฉ**: ุฌููุน ุงูุจูุงูุงุช ูู ุทูุจ ูุงุญุฏ
- โ **ุชุตูุญ ุจุงูุตูุญุงุช**: ุชุญูู ูู ุญุฌู ุงูุจูุงูุงุช

## ๐ ุงูุชูุงูู ูุน ุงููุธุงู ุงูููุฌูุฏ

### **1. ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- โ **ุฌุฏุงูู ููุฌูุฏุฉ**: ุงุณุชุฎุฏุงู `ticket_comments` ุงูุญุงูู
- โ **ุฃูุดุทุฉ ุงูุชุฐุงูุฑ**: ุชุณุฌูู ูู `ticket_activities`
- โ **ุนูุงูุงุช ุตุญูุญุฉ**: Foreign keys ุณูููุฉ

### **2. ุงููุตุงุฏูุฉ ูุงูุตูุงุญูุงุช**
- โ **ูุธุงู ููุฌูุฏ**: ุงุณุชุฎุฏุงู `authenticateToken`
- โ **ุตูุงุญูุงุช ูุญุฏุฏุฉ**: `tickets.read`, `tickets.update`
- โ **ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู**: ุฏุนู `admin`, `super_admin`

### **3. ูููู ุงูุงุณุชุฌุงุจุฉ**
- โ **ุชูุณูู ููุญุฏ**: `{ success, data, message }`
- โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก**: ุฑููุฒ HTTP ุตุญูุญุฉ
- โ **ุชุตูุญ ุจุงูุตูุญุงุช**: `{ page, limit, total, pages }`

## โ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### **ุงููุชูุฌุฉ ุงูุนุงูุฉ**: ๐ **ูุฌุญ ุงููุดุฑูุน ุจุงูุชูุงุฒ**

ุชู ุชุทููุฑ ูุธุงู ุฅุฏุงุฑุฉ ุชุนูููุงุช ูุชูุงูู ูุนุงูู ุงูุฌูุฏุฉ ูุญูู ุฌููุน ุงููุชุทูุจุงุช:

1. โ **ุฌูุจ ุงูุชุนูููุงุช**: ูุน ุงูุชุฐูุฑุฉ ุฃู ูููุตูุงู
2. โ **ุฅุถุงูุฉ ุชุนููู**: ุนุงู ุฃู ุฏุงุฎูู ูุน ุชุณุฌูู ุงููุดุงุท
3. โ **ุญุฐู ุชุนููู**: ุจุตูุงุญูุงุช ูุญุฏุฏุฉ (ุงููุคูู ุฃู ุงููุฏูุฑ)
4. โ **ุชุญุฏูุซ ุงูุชุนูููุงุช**: ูููุคูู ููุท
5. โ **ุงูุจุญุซ ูุงูุชุตููุฉ**: ูุชูุฏู ููุฑู
6. โ **ุงูุฃูุงู**: ูุตุงุฏูุฉ ูุตูุงุญูุงุช ุดุงููุฉ
7. โ **ุงูุชูุซูู**: Swagger ูุงูู ูุน ุฃูุซูุฉ
8. โ **ุงูุงุฎุชุจุงุฑ**: ูุญุต ุดุงูู ููุงุฌุญ 100%

**ุงูุชูุตูุฉ**: ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ ููุฑุงู! ๐

---

**ุชุงุฑูุฎ ุงูุชุทููุฑ**: 2025-09-23  
**ุญุงูุฉ ุงููุดุฑูุน**: โ ููุชูู ููุฎุชุจุฑ  
**ูุณุชูู ุงูุฌูุฏุฉ**: โญโญโญโญโญ (5/5)  
**ูุนุฏู ูุฌุงุญ ุงูุงุฎุชุจุงุฑุงุช**: 100% (9/9)
