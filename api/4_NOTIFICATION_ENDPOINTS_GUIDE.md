# ๐ฌ ุฏููู ุงูู 4 Notification Endpoints ุงููุทููุจุฉ

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ูุดุฑุญ ุงูู 4 endpoints ุงููุทููุจุฉ ูุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช ูุน ุจูุงูุงุช ุงููุณุชุฎุฏููู.

---

## 1๏ธโฃ ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูุน ุจูุงูุงุช ุงููุณุชุฎุฏููู

### Endpoint:
```
GET /api/notifications/all
```

### ุงููุตู:
ูุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูู ุงููุธุงู ูุน ูุนูููุงุช ุงููุณุชุฎุฏููู ุงููุฑุชุจุทุฉ ุจูู ุฅุดุนุงุฑ.

### Parameters:

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| user_id | UUID | ูุง | - | ููุชุฑ ุญุณุจ ูุนุฑู ุงููุณุชุฎุฏู |
| notification_type | String | ูุง | - | ููุชุฑ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ |
| is_read | Boolean | ูุง | - | ููุชุฑ ุญุณุจ ุญุงูุฉ ุงููุฑุงุกุฉ |
| from_date | DateTime | ูุง | - | ููุชุฑ ูู ุชุงุฑูุฎ |
| to_date | DateTime | ูุง | - | ููุชุฑ ุฅูู ุชุงุฑูุฎ |
| limit | Integer | ูุง | 50 | ุนุฏุฏ ุงููุชุงุฆุฌ |
| offset | Integer | ูุง | 0 | ุงูุฅุฒุงุญุฉ |
| order_by | String | ูุง | created_at | ุงูุชุฑุชูุจ ุญุณุจ |
| order_dir | String | ูุง | DESC | ุงุชุฌุงู ุงูุชุฑุชูุจ |

### ูุซุงู ุนูู ุงูุทูุจ:
```bash
GET /api/notifications/all?limit=10&is_read=false
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ:
```json
{
  "success": true,
  "message": "ุชู ุฌูุจ ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ",
  "data": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "user_id": "789e0123-e45f-67g8-h901-234567890123",
      "user_name": "ุฃุญูุฏ ูุญูุฏ",
      "user_email": "ahmed@example.com",
      "user_avatar": "https://example.com/avatar.jpg",
      "title": "ุชุฐูุฑุฉ ุฌุฏูุฏุฉ",
      "message": "ุชู ุชุนููู ุชุฐูุฑุฉ ุฌุฏูุฏุฉ ูู",
      "notification_type": "ticket_assigned",
      "is_read": false,
      "read_at": null,
      "data": {
        "ticket_id": "456",
        "priority": "high"
      },
      "action_url": "/tickets/456",
      "expires_at": null,
      "created_at": "2025-10-10T15:30:00.000Z"
    }
  ],
  "pagination": {
    "limit": 10,
    "offset": 0,
    "count": 1
  }
}
```

### ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
- โ ูุนูููุงุช ุงูุฅุดุนุงุฑ ุงููุงููุฉ
- โ ูุนูููุงุช ุงููุณุชุฎุฏู (ุงูุงุณูุ ุงูุจุฑูุฏุ ุงูุตูุฑุฉ)
- โ ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ (data field)
- โ ุฑุงุจุท ุงูุฅุฌุฑุงุก (action_url)
- โ ูุนูููุงุช Pagination

---

## 2๏ธโฃ ุฌูุจ ุฅุดุนุงุฑ ูุงุญุฏ ุจุฏูุงูุฉ ID

### Endpoint:
```
GET /api/notifications/:id
```

### ุงููุตู:
ูุฌูุจ ุชูุงุตูู ุฅุดุนุงุฑ ูุญุฏุฏ ูุน ูุนูููุงุช ุงููุณุชุฎุฏู ุงููุฑุชุจุท ุจู.

### Parameters:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| id | UUID | ูุนู (ูู URL) | ูุนุฑู ุงูุฅุดุนุงุฑ |

### ูุซุงู ุนูู ุงูุทูุจ:
```bash
GET /api/notifications/123e4567-e89b-12d3-a456-426614174000
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ:
```json
{
  "success": true,
  "message": "ุชู ุฌูุจ ุงูุฅุดุนุงุฑ ุจูุฌุงุญ",
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "user_id": "789e0123-e45f-67g8-h901-234567890123",
    "user_name": "ุฃุญูุฏ ูุญูุฏ",
    "user_email": "ahmed@example.com",
    "user_avatar": "https://example.com/avatar.jpg",
    "title": "ุชุฐูุฑุฉ ุฌุฏูุฏุฉ",
    "message": "ุชู ุชุนููู ุชุฐูุฑุฉ ุฌุฏูุฏุฉ ูู",
    "notification_type": "ticket_assigned",
    "is_read": false,
    "read_at": null,
    "data": {
      "ticket_id": "456",
      "priority": "high"
    },
    "action_url": "/tickets/456",
    "expires_at": null,
    "created_at": "2025-10-10T15:30:00.000Z"
  }
}
```

### ุญุงูุฉ ุงูุฎุทุฃ (404):
```json
{
  "success": false,
  "message": "ุงูุฅุดุนุงุฑ ุบูุฑ ููุฌูุฏ"
}
```

### ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
- โ ุฌููุน ุชูุงุตูู ุงูุฅุดุนุงุฑ
- โ ูุนูููุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ
- โ ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ
- โ ุฑุงุจุท ุงูุฅุฌุฑุงุก

---

## 3๏ธโฃ ุฌูุจ ุฅุดุนุงุฑุงุช ูุณุชุฎุฏู ูุนูู

### Endpoint:
```
GET /api/notifications/user/:user_id
```

### ุงููุตู:
ูุฌูุจ ุฌููุน ุฅุดุนุงุฑุงุช ูุณุชุฎุฏู ูุญุฏุฏ ูุน ุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ.

### Parameters:

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| user_id | UUID | ูุนู (ูู URL) | - | ูุนุฑู ุงููุณุชุฎุฏู |
| is_read | Boolean | ูุง | - | ููุชุฑ ุญุณุจ ุญุงูุฉ ุงููุฑุงุกุฉ |
| notification_type | String | ูุง | - | ููุชุฑ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ |
| limit | Integer | ูุง | 50 | ุนุฏุฏ ุงููุชุงุฆุฌ |
| offset | Integer | ูุง | 0 | ุงูุฅุฒุงุญุฉ |

### ูุซุงู ุนูู ุงูุทูุจ:
```bash
GET /api/notifications/user/789e0123-e45f-67g8-h901-234567890123?limit=10&is_read=false
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ:
```json
{
  "success": true,
  "message": "ุชู ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู ุจูุฌุงุญ",
  "data": {
    "notifications": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "user_id": "789e0123-e45f-67g8-h901-234567890123",
        "user_name": "ุฃุญูุฏ ูุญูุฏ",
        "user_email": "ahmed@example.com",
        "user_avatar": "https://example.com/avatar.jpg",
        "title": "ุชุฐูุฑุฉ ุฌุฏูุฏุฉ",
        "message": "ุชู ุชุนููู ุชุฐูุฑุฉ ุฌุฏูุฏุฉ ูู",
        "notification_type": "ticket_assigned",
        "is_read": false,
        "created_at": "2025-10-10T15:30:00.000Z"
      }
    ],
    "unread_count": 5,
    "stats": {
      "total_notifications": "25",
      "unread_count": "5",
      "read_count": "20",
      "ticket_assigned_count": "10",
      "ticket_updated_count": "8",
      "comment_added_count": "5",
      "mention_count": "2",
      "last_notification_at": "2025-10-10T15:30:00.000Z"
    }
  },
  "pagination": {
    "limit": 10,
    "offset": 0,
    "count": 1
  }
}
```

### ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
- โ ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช
- โ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ ุฅุญุตุงุฆูุงุช ุชูุตูููุฉ:
  - ุฅุฌูุงูู ุงูุฅุดุนุงุฑุงุช
  - ุนุฏุฏ ุงูููุฑูุกุฉ ูุบูุฑ ุงูููุฑูุกุฉ
  - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุญุณุจ ุงูููุน
  - ุชุงุฑูุฎ ุขุฎุฑ ุฅุดุนุงุฑ

---

## 4๏ธโฃ ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูุน ุงููุณุชุฎุฏููู ุงููุนูููู

### Endpoint:
```
GET /api/notifications/with-users
```

### ุงููุตู:
ูุฌูุจ ุงูุฅุดุนุงุฑุงุช ูุน ูุนูููุงุช ุงููุณุชุฎุฏููู ุงููุนูููู (ุงููุฐููุฑูู ูู ุงูุฅุดุนุงุฑ).

### Parameters:

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| notification_type | String | ูุง | - | ููุชุฑ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ |
| from_date | DateTime | ูุง | - | ููุชุฑ ูู ุชุงุฑูุฎ |
| limit | Integer | ูุง | 50 | ุนุฏุฏ ุงููุชุงุฆุฌ |
| offset | Integer | ูุง | 0 | ุงูุฅุฒุงุญุฉ |

### ูุซุงู ุนูู ุงูุทูุจ:
```bash
GET /api/notifications/with-users?limit=5
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ:
```json
{
  "success": true,
  "message": "ุชู ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูุน ุงููุณุชุฎุฏููู ุงููุนูููู ุจูุฌุงุญ",
  "data": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "user_id": "789e0123-e45f-67g8-h901-234567890123",
      "user_name": "ุฃุญูุฏ ูุญูุฏ",
      "user_email": "ahmed@example.com",
      "user_avatar": "https://example.com/avatar.jpg",
      "title": "ุชู ุฐูุฑู ูู ุชุนููู",
      "message": "ุฐูุฑู ุณุงุฑุฉ ูู ุชุนููู ุนูู ุงูุชุฐูุฑุฉ #456",
      "notification_type": "mention",
      "is_read": false,
      "related_users": [
        {
          "id": "abc123-def456",
          "name": "ุณุงุฑุฉ ุนูู",
          "email": "sara@example.com",
          "avatar": "https://example.com/sara.jpg"
        }
      ],
      "created_at": "2025-10-10T15:30:00.000Z"
    }
  ],
  "pagination": {
    "limit": 5,
    "offset": 0,
    "count": 1
  }
}
```

### ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
- โ ูุนูููุงุช ุงูุฅุดุนุงุฑ
- โ ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุฑุฆูุณู
- โ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงููุนูููู (related_users)
- โ ูุนูููุงุช ูู ูุณุชุฎุฏู ูุนูู (ุงูุงุณูุ ุงูุจุฑูุฏุ ุงูุตูุฑุฉ)

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุดุงูู ููู 4 endpoints:
```bash
node test-4-notification-endpoints.js
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
```
โ ูุฌุญ: 4/4
๐ ูุณุจุฉ ุงููุฌุงุญ: 100.00%
๐ ุชูุงูููุง! ุฌููุน ุงูู 4 endpoints ุชุนูู ุจุดูู ุตุญูุญ!
```

---

## ๐ ุงููุตุงุฏูุฉ

ุฌููุน ุงูู endpoints ุชุชุทูุจ ูุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู JWT Token:

```
Authorization: Bearer YOUR_JWT_TOKEN
```

### ููุญุตูู ุนูู ุงูุชููู:
```bash
POST /api/auth/login
{
  "email": "admin@example.com",
  "password": "admin123"
}
```

---

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฏุนููุฉ

| Type | Description |
|------|-------------|
| `ticket_assigned` | ุชู ุชุนููู ุชุฐูุฑุฉ |
| `ticket_updated` | ุชู ุชุญุฏูุซ ุชุฐูุฑุฉ |
| `ticket_moved` | ุชู ุชุญุฑูู ุชุฐูุฑุฉ |
| `comment_added` | ุชู ุฅุถุงูุฉ ุชุนููู |
| `mention` | ุชู ุฐูุฑ ุงููุณุชุฎุฏู |
| `system_update` | ุชุญุฏูุซ ุงููุธุงู |
| `reminder` | ุชุฐููุฑ |

---

## ๐ก ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู

### JavaScript (Frontend):
```javascript
// 1. ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช
const allNotifications = await fetch('/api/notifications/all?limit=20', {
  headers: { 'Authorization': `Bearer ${token}` }
});

// 2. ุฌูุจ ุฅุดุนุงุฑ ูุงุญุฏ
const notification = await fetch(`/api/notifications/${notificationId}`, {
  headers: { 'Authorization': `Bearer ${token}` }
});

// 3. ุฌูุจ ุฅุดุนุงุฑุงุช ูุณุชุฎุฏู
const userNotifications = await fetch(`/api/notifications/user/${userId}`, {
  headers: { 'Authorization': `Bearer ${token}` }
});

// 4. ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูุน ุงููุณุชุฎุฏููู
const withUsers = await fetch('/api/notifications/with-users?limit=10', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู

ูุจู ุงูุงุฎุชุจุงุฑ:
- [ ] ุงูุณูุฑูุฑ ูุนูู
- [ ] ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ
- [ ] ููุฌุฏ ูุณุชุฎุฏู admin
- [ ] ุชูุฌุฏ ุจูุงูุงุช ูู ุฌุฏูู notifications

ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ:
- [ ] ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูุนูู
- [ ] ุฌูุจ ุฅุดุนุงุฑ ูุงุญุฏ ูุนูู
- [ ] ุฌูุจ ุฅุดุนุงุฑุงุช ูุณุชุฎุฏู ูุนูู
- [ ] ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูุน ุงููุณุชุฎุฏููู ูุนูู

ุจุนุฏ ุงูุงุฎุชุจุงุฑ:
- [ ] ุฌููุน ุงูุจูุงูุงุช ุตุญูุญุฉ
- [ ] ูุนูููุงุช ุงููุณุชุฎุฏููู ูุถููุฉ
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: pool.query is not a function
**ุงูุญู:** 
1. ุชุฃูุฏ ูู ุฃู ุงูุณุทุฑ 2 ูู `NotificationController.js` ูู:
   ```javascript
   const { pool } = require('../config/database');
   ```
2. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ

### ุฎุทุฃ: 401 Unauthorized
**ุงูุญู:** ุชุฃูุฏ ูู ุตุญุฉ ุงูุชููู

### ุฎุทุฃ: 404 Not Found
**ุงูุญู:** ุชุฃูุฏ ูู ุตุญุฉ ุงูู ID

### ูุง ุชูุฌุฏ ุจูุงูุงุช
**ุงูุญู:** ุชุฃูุฏ ูู ูุฌูุฏ ุฅุดุนุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

**ุชู ุงูุฅูุดุงุก:** 2025-10-10  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
