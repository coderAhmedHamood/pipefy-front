# ๐ ูุธุงู ุชูููุฐ ููุงุนุฏ ุงูุชูุฑุงุฑ ุงูุชููุงุฆู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ูุชูููุฐ ููุงุนุฏ ุงูุชูุฑุงุฑ ุงูุชููุงุฆู ูู ูุธุงู Pipefy. ูุฐุง ุงููุธุงู ูููู ุจุฌูุจ ุจูุงูุงุช ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ูุชูููุฐ ุฌููุน ุงูุฎุทูุงุช ุงููุทููุจุฉ ุชููุงุฆูุงู.

## ๐ฏ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ

### 1. ุฌูุจ ุจูุงูุงุช ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- ูุณุชุฎุฏู ููุณ ุงูู endpoint ุงูููุฌูุฏ: `GET /api/recurring/rules/{id}`
- ูุฌูุจ ุฌููุน ุงูุญููู ูู ุฌุฏูู `recurring_rules`
- ูุชุถูู ูุนูููุงุช ุงูุนูููุฉ ูุงููุฑุญูุฉ

### 2. ุฅูุดุงุก ุงูุชุฐูุฑุฉ
- ูุณุชุฏุนู `POST /api/tickets` ุชููุงุฆูุงู
- ูุฑุณู ุงูุจูุงูุงุช ุงููุทููุจุฉ ูู ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- ูุญุตู ุนูู ูุนุฑู ุงูุชุฐูุฑุฉ ุงูุฌุฏูุฏุฉ

### 3. ุฅุณูุงุฏ ุงููุณุชุฎุฏู
- ูุณุชุฏุนู `POST /api/ticket-assignments` ุชููุงุฆูุงู
- ูุณูุฏ ุงููุณุชุฎุฏู ุงููุญุฏุฏ ูู ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- ูุถูู ููุงุญุธุฉ ุชุดูุฑ ููุตุฏุฑ ุงูุฅุณูุงุฏ

### 4. ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
- ูุณุชุฏุนู `POST /api/notifications/bulk` ุชููุงุฆูุงู
- ูุฑุณู ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุงูููุณูุฏ
- ูุชุถูู ุฑุงุจุท ูุจุงุดุฑ ููุชุฐูุฑุฉ

### 5. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- ูุฒูุฏ `execution_count` ุจู 1
- ูุญุณุจ `next_execution_date` ุงูุชุงูู
- ูุถุน `end_date` ุนูุฏ ุงูุงูุชูุงุก
- ูุญูู ุงููุงุนุฏุฉ ูุบูุฑ ูุดุทุฉ ุนูุฏ ุงูุชูุงู ุงูุชูููุฐุงุช

## ๐๏ธ ุงููููุงุช ุงููููุดุฃุฉ

### 1. Controller ุงูุฌุฏูุฏ
```
controllers/RecurringExecutionController.js
```

**ุงููุธุงุฆู:**
- `executeRule()` - ุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- `getAndExecute()` - ุฌูุจ ูุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- `calculateNextExecutionDate()` - ุญุณุงุจ ุงูุชุงุฑูุฎ ุงูุชุงูู

### 2. Routes ุงูุฌุฏูุฏ
```
routes/recurring-execution.js
```

**ุงูู Endpoints:**
- `POST /api/recurring/rules/{id}/run` - ุฌูุจ ูุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
- `POST /api/recurring/rules/{id}/execute-only` - ุชูููุฐ ููุท

### 3. ููู ุงูุงุฎุชุจุงุฑ
```
test-recurring-execution.js
```

**ุงููุธุงุฆู:**
- ุงุฎุชุจุงุฑ ุชูููุฐ ูุงุนุฏุฉ ูุงุญุฏุฉ
- ุงุฎุชุจุงุฑ ุชูููุฐ ูุชุนุฏุฏ
- ุนุฑุถ ุงููุชุงุฆุฌ ุงูุชูุตูููุฉ

## ๐ก ุงูู Endpoints ุงูุฌุฏูุฏุฉ

### 1. POST /api/recurring/rules/{id}/run

**ุงููุตู:** ุฌูุจ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ูุชูููุฐูุง ูุน ุฌููุน ุงูุฎุทูุงุช

**ุงููุนุงููุงุช:**
- `id` (path) - ูุนุฑู ูุงุนุฏุฉ ุงูุชูุฑุงุฑ

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "success": true,
  "message": "ุชู ุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ุจูุฌุงุญ",
  "data": {
    "rule": {
      "id": "uuid",
      "name": "ุงุณู ุงููุงุนุฏุฉ",
      "execution_count": 2,
      "recurrence_interval": 5,
      "is_active": true,
      "next_execution_date": "2025-11-05T21:50:28.292Z"
    },
    "ticket": {
      "id": "uuid",
      "ticket_number": "ุนูู-000123",
      "title": "ุนููุงู ุงูุชุฐูุฑุฉ"
    },
    "assignment": {
      "id": "uuid",
      "user_id": "uuid",
      "role": "assignee"
    },
    "notification": {
      "success": true,
      "sent_count": 1
    },
    "execution_info": {
      "current_execution": 2,
      "total_executions": 5,
      "is_completed": false,
      "next_execution_date": "2025-11-05T21:50:28.292Z",
      "end_date": null
    }
  }
}
```

### 2. POST /api/recurring/rules/{id}/execute-only

**ุงููุตู:** ุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ููุท (ุจุฏูู ุฌูุจ ุงูุจูุงูุงุช ูุณุจูุงู)

**ููุณ ุงููุนุงููุงุช ูุงูุงุณุชุฌุงุจุฉ**

## ๐ ุขููุฉ ุงูุชูุฑุงุฑ

### 1. ุนุฏุงุฏ ุงูุชูููุฐ
```javascript
// ูุจู ุงูุชูููุฐ
execution_count: 0
recurrence_interval: 3

// ุจุนุฏ ุงูุชูููุฐ ุงูุฃูู
execution_count: 1
recurrence_interval: 3

// ุจุนุฏ ุงูุชูููุฐ ุงูุซุงูู
execution_count: 2
recurrence_interval: 3

// ุจุนุฏ ุงูุชูููุฐ ุงูุซุงูุซ (ุงูุฃุฎูุฑ)
execution_count: 3
recurrence_interval: 3
is_active: false
end_date: "2025-10-29T22:00:00.000Z"
```

### 2. ุญุณุงุจ ุงูุชุงุฑูุฎ ุงูุชุงูู

**ูููู:**
```javascript
next_execution_date = current_date + 1 day
```

**ุฃุณุจูุนู:**
```javascript
next_execution_date = current_date + 7 days
```

**ุดูุฑู:**
```javascript
next_execution_date = current_date + 1 month
```

**ุณููู:**
```javascript
next_execution_date = current_date + 1 year
```

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุชุดุบูู ููู ุงูุงุฎุชุจุงุฑ
```bash
node test-recurring-execution.js
```

### 2. ุงุฎุชุจุงุฑ ูุฏูู ุจุงุณุชุฎุฏุงู curl

**ุฌูุจ ููุงุนุฏ ุงูุชูุฑุงุฑ:**
```bash
curl -X GET "http://localhost:3003/api/recurring/rules" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**ุชูููุฐ ูุงุนุฏุฉ ุชูุฑุงุฑ:**
```bash
curl -X POST "http://localhost:3003/api/recurring/rules/{RULE_ID}/run" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

### 3. ูุฑุงูุจุฉ ุงูุณุฌูุงุช
```bash
# ูู terminal ูููุตู
tail -f logs/app.log
```

## ๐ ูุซุงู ุนูู ุงูุชูููุฐ ุงููุงูู

### ุงูุจูุงูุงุช ุงูุฃูููุฉ:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "ุชุฐูุฑุฉ ุฃุณุจูุนูุฉ ูููุฑุงุฌุนุฉ",
  "title": "ูุฑุงุฌุนุฉ ุฃุณุจูุนูุฉ",
  "description": "ูุฑุงุฌุนุฉ ุงูุฃุฏุงุก ุงูุฃุณุจูุนู",
  "process_id": "proc-123",
  "current_stage_id": "stage-456",
  "assigned_to_id": "user-789",
  "assigned_to_name": "ุฃุญูุฏ ูุญูุฏ",
  "execution_count": 0,
  "recurrence_interval": 3,
  "recurrence_type": "weekly",
  "is_active": true
}
```

### ุฎุทูุงุช ุงูุชูููุฐ:

1. **ุฌูุจ ุงูุจูุงูุงุช** โ
   - ุชู ุฌูุจ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ุจูุฌุงุญ

2. **ุฅูุดุงุก ุงูุชุฐูุฑุฉ** โ
   - POST /api/tickets
   - ุชุฐูุฑุฉ ุฌุฏูุฏุฉ: ุนูู-000456

3. **ุฅุณูุงุฏ ุงููุณุชุฎุฏู** โ
   - POST /api/ticket-assignments
   - ุชู ุฅุณูุงุฏ: ุฃุญูุฏ ูุญูุฏ

4. **ุฅุฑุณุงู ุงูุฅุดุนุงุฑ** โ
   - POST /api/notifications/bulk
   - ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุชุฎุฏู ูุงุญุฏ

5. **ุชุญุฏูุซ ุงููุงุนุฏุฉ** โ
   - execution_count: 0 โ 1
   - next_execution_date: +7 ุฃูุงู
   - is_active: true (ูุง ุชุฒุงู ูุดุทุฉ)

### ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
```json
{
  "success": true,
  "message": "ุชู ุชูููุฐ ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ุจูุฌุงุญ",
  "data": {
    "execution_info": {
      "current_execution": 1,
      "total_executions": 3,
      "is_completed": false,
      "next_execution_date": "2025-11-05T21:50:28.292Z"
    }
  }
}
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงููุชุทูุจุงุช
- ูุฌุจ ุฃู ุชููู ูุงุนุฏุฉ ุงูุชูุฑุงุฑ ูุดุทุฉ (`is_active = true`)
- ูุฌุจ ุฃู ูููู `execution_count < recurrence_interval`
- ูุฌุจ ูุฌูุฏ token ุตุงูุญ ูููุตุงุฏูุฉ

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ูู ุญุงูุฉ ูุดู ุฃู ุฎุทูุฉุ ูุชู ุชุณุฌูู ุงูุฎุทุฃ
- ูุง ูุชู ุชุญุฏูุซ `execution_count` ูู ุญุงูุฉ ุงููุดู
- ูุชู ุญูุธ ุฑุณุงูุฉ ุงูุฎุทุฃ ูู `last_execution_error`

### 3. ุงูุฃูุงู
- ุฌููุน ุงูู endpoints ูุญููุฉ ุจู authentication
- ูุชู ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
- ูุง ูููู ุชูููุฐ ููุงุนุฏ ุบูุฑ ูุดุทุฉ

### 4. ุงูุฃุฏุงุก
- ุชุฃุฎูุฑ ูุตูุฑ ุจูู ุงูุงุณุชุฏุนุงุกุงุช ูุชุฌูุจ ุงูุญูู ุงูุฒุงุฆุฏ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุขูู
- ุชุณุฌูู ููุตู ูุฌููุน ุงูุนูููุงุช

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ุงููุธุงู** ูุน ุจูุงูุงุช ุญููููุฉ
2. **ุฅุถุงูุฉ ุฌุฏููุฉ ุชููุงุฆูุฉ** (Cron Jobs)
3. **ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**
4. **ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุงูุชูููุฐ**
5. **ุชุทููุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู**

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู ุฃู ุฃุณุฆูุฉ:
1. ุชุญูู ูู ุงูุณุฌูุงุช ูู `logs/app.log`
2. ุชุฃูุฏ ูู ุตุญุฉ ุจูุงูุงุช ูุงุนุฏุฉ ุงูุชูุฑุงุฑ
3. ุชุญูู ูู ุตูุงุญูุฉ token ุงููุณุชุฎุฏู
4. ุฑุงุฌุน ุงุณุชุฌุงุจุงุช ุงูู APIs ุงููุณุชุฏุนุงุฉ

---

**ุชู ุฅูุดุงุก ุงููุธุงู ุจุชุงุฑูุฎ:** 29 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
