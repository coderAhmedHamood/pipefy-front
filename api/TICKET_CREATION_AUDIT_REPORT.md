# ๐ ุชูุฑูุฑ ูุญุต ุนูููุฉ ุฅูุดุงุก ุงูุชุฐูุฑุฉ

## ๐ฏ ุงููุฏู ูู ุงููุญุต
ูุญุต ุนูููุฉ ุฅูุดุงุก ุงูุชุฐูุฑุฉ ุงูุฌุฏูุฏุฉ ุนุจุฑ ุงูู endpoint `POST /api/tickets` ูุงูุชุฃูุฏ ูู ุฃููุง ุชุถูู ุงูุจูุงูุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุณููู.

## ๐ง ุงููุดุงูู ุงูุชู ุชู ุงูุชุดุงููุง ูุฅุตูุงุญูุง

### 1. โ ูุดููุฉ ุฏุงูุฉ ุชูููุฏ ุฑูู ุงูุชุฐูุฑุฉ
**ุงููุดููุฉ**: ุฎุทุฃ ูู ุฏุงูุฉ `generate_ticket_number` - ุนููุฏ `ticket_number` ุบุงูุถ
```sql
-- ุงููุดููุฉ ุงูุฃุตููุฉ
WHERE tickets.process_id = generate_ticket_number.process_id;
```

**ุงูุญู**: ุชู ุฅุตูุงุญ ุงูุฏุงูุฉ ูุชุฌูุจ ุชุถุงุฑุจ ุงูุฃุณูุงุก
```sql
-- ุงูุญู ุงููุทุจู
CREATE OR REPLACE FUNCTION generate_ticket_number(p_process_id UUID)
RETURNS TEXT AS $$
DECLARE
  process_name TEXT;
  process_prefix TEXT;
  counter INTEGER;
  ticket_number TEXT;
BEGIN
  -- ุฌูุจ ุงุณู ุงูุนูููุฉ
  SELECT name INTO process_name FROM processes WHERE id = p_process_id;
  
  -- ุฅูุดุงุก ุจุงุฏุฆุฉ ูู 3 ุฃุญุฑู ุฅูุฌููุฒูุฉ ุฃู TKT ูุงูุชุฑุงุถู
  process_prefix := UPPER(LEFT(REGEXP_REPLACE(process_name, '[^A-Za-z]', '', 'g'), 3));
  IF LENGTH(process_prefix) < 3 THEN
    process_prefix := 'TKT';
  END IF;
  
  -- ุฌูุจ ุงูุนุฏุงุฏ ุงูุชุงูู
  SELECT COALESCE(MAX(CAST(SUBSTRING(t.ticket_number FROM '[0-9]+$') AS INTEGER)), 0) + 1
  INTO counter
  FROM tickets t
  WHERE t.process_id = p_process_id;
  
  -- ุชูููู ุฑูู ุงูุชุฐูุฑุฉ
  ticket_number := process_prefix || '-' || LPAD(counter::TEXT, 6, '0');
  
  RETURN ticket_number;
END;
$$ LANGUAGE plpgsql;
```

### 2. โ ูุดููุฉ ูุนุฑู ุงููุณุชุฎุฏู
**ุงููุดููุฉ**: ุงุณุชุฎุฏุงู `req.user.userId` ุจุฏูุงู ูู `req.user.id`
```javascript
// ุงููุดููุฉ ุงูุฃุตููุฉ
created_by: req.user.userId
```

**ุงูุญู**: ุชู ุชุตุญูุญ ุฌููุน ุงููุฑุงุฌุน ูุงุณุชุฎุฏุงู `req.user.id`
```javascript
// ุงูุญู ุงููุทุจู
created_by: req.user.id
```

## โ ูุชุงุฆุฌ ุงููุญุต ุงูุดุงูู

### ๐ซ ุฅูุดุงุก ุงูุชุฐูุฑุฉ
- โ **ุชู ุฅูุดุงุก ุงูุชุฐูุฑุฉ ุจูุฌุงุญ**
- โ **ุฑูู ุงูุชุฐูุฑุฉ**: `TKT-000001` (ุชูุณูู ุตุญูุญ)
- โ **ูุนุฑู ูุฑูุฏ**: `271fe906-87a1-45b1-b534-4eeab541f679`
- โ **ุงูุญุงูุฉ**: `active` (ุงูุชุฑุงุถูุฉ ุตุญูุญุฉ)
- โ **ุชุงุฑูุฎ ุงูุฅูุดุงุก**: ูุญููุธ ุจุดูู ุตุญูุญ

### ๐ ุงูุจูุงูุงุช ุงููุญููุธุฉ
```json
{
  "id": "271fe906-87a1-45b1-b534-4eeab541f679",
  "ticket_number": "TKT-000001",
  "title": "ุชุฐูุฑุฉ ุงุฎุชุจุงุฑ - ูขูฃโ/ูฉโ/ูขููขูฅุ ูกูข:ูฅูฃ:ูฅูฅ ุต",
  "description": "ูุฐู ุชุฐูุฑุฉ ุงุฎุชุจุงุฑ ููุญุต ุนูููุฉ ุงูุฅูุดุงุก ูุงูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช",
  "process_id": "049a99f6-d427-4f21-b3a6-be2c01a03f00",
  "current_stage_id": "50e26e53-e661-43fb-94ff-5b3103ab5f27",
  "created_by": "a00a2f8e-2843-41da-8080-6eb4cd0a706b",
  "priority": "medium",
  "status": "active",
  "due_date": "2025-09-29T21:53:55.486Z",
  "estimated_hours": "5.50",
  "tags": ["ุงุฎุชุจุงุฑ", "ุชุฌุฑูุจู"],
  "data": {
    "timestamp": "2025-09-22T21:53:55.486Z",
    "test_field": "ูููุฉ ุงุฎุชุจุงุฑ",
    "created_by_test": true
  }
}
```

### ๐ ุงููุฑุญูุฉ ุงูุฃููู
- โ **ุชู ุชุนููู ุงููุฑุญูุฉ ุงูุฃููู ุชููุงุฆูุงู**
- โ **ุงุณู ุงููุฑุญูุฉ**: "ูุฑุญูุฉ ุฌุฏูุฏุฉ"
- โ **ูุนุฑู ุงููุฑุญูุฉ**: `50e26e53-e661-43fb-94ff-5b3103ab5f27`
- โ **ุงููุทุงุจูุฉ**: ุงููุฑุญูุฉ ุงูุญุงููุฉ ููุชุฐูุฑุฉ ุชุทุงุจู ุงููุฑุญูุฉ ุงูุฃููู ููุนูููุฉ

### ๐ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ุงูุชุฐูุฑุฉ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- โ **ุฌููุน ุงูุจูุงูุงุช ูุชุทุงุจูุฉ** ุจูู ุงูุงุณุชุฌุงุจุฉ ูุงููุงุนุฏุฉ
- โ **ุงูุนูุงูุงุช ุตุญูุญุฉ** (ุงูุนูููุฉุ ุงููุฑุญูุฉุ ุงููุณุชุฎุฏู)

### ๐ก๏ธ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- โ **ุฑูุถ ุงูุจูุงูุงุช ุงูุฎุงุทุฆุฉ**: ุชู ุฑูุถ ุงูุชุฐูุฑุฉ ุจูุนุงููุงุช ุบูุฑ ุตุญูุญุฉ
- โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**: ุงููุธุงู ูุนุทู ุฑุณุงุฆู ุฎุทุฃ ูููููุฉ
- โ **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช**: ูุชุทูุจ ูุตุงุฏูุฉ ูุตูุงุญูุงุช ุตุญูุญุฉ

## ๐ ุงูุนูููุงุช ุงูููุฌุฒุฉ ุชููุงุฆูุงู

### 1. ุชูููุฏ ุฑูู ุงูุชุฐูุฑุฉ
```sql
-- ูุชู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุชููุงุฆูุงู
SELECT generate_ticket_number($1) as ticket_number
```
- โ **ุงูุจุงุฏุฆุฉ**: `TKT` (ููุฃุณูุงุก ุงูุนุฑุจูุฉ)
- โ **ุงูุนุฏุงุฏ**: `000001` (6 ุฃุฑูุงู ูุน ุฃุตูุงุฑ ุจุงุฏุฆุฉ)
- โ **ุงูุชูุณูู**: `TKT-000001`

### 2. ุชุนููู ุงููุฑุญูุฉ ุงูุฃููู
```sql
-- ูุชู ุงูุจุญุซ ุนู ุงููุฑุญูุฉ ุงูุฃููู ุชููุงุฆูุงู
SELECT id FROM stages 
WHERE process_id = $1 AND is_initial = true
ORDER BY order_index, priority
LIMIT 1
```

### 3. ุชุณุฌูู ุงููุดุงุท
```sql
-- ูุชู ุฅุถุงูุฉ ูุดุงุท ุงูุฅูุดุงุก ุชููุงุฆูุงู
INSERT INTO ticket_activities (
  ticket_id, user_id, activity_type, description,
  old_values, new_values, metadata
)
```

### 4. ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุฎุตุตุฉ
- โ **ุชุญููู JSON**: ุงูุจูุงูุงุช ุงููุฎุตุตุฉ ุชูุญูุธ ูู JSONB
- โ **ุงูุญูุธ**: ุฌููุน ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ ูุญููุธุฉ ุจุดูู ุตุญูุญ
- โ **ุงูุงุณุชุฑุฌุงุน**: ุงูุจูุงูุงุช ุชูุณุชุฑุฌุน ุจููุณ ุงูุชูุณูู

## ๐ง ุงูููุฒุงุช ุงููุคูุฏุฉ

### 1. Transaction Safety
- โ **BEGIN/COMMIT**: ุงูุนูููุฉ ุชุชู ุฏุงุฎู transaction
- โ **ROLLBACK**: ูู ุญุงูุฉ ุงูุฎุทุฃุ ูุชู ุงูุชุฑุงุฌุน ุนู ุฌููุน ุงูุชุบููุฑุงุช
- โ **Atomicity**: ุฅูุง ุชุชู ุงูุนูููุฉ ูุงููุฉ ุฃู ูุง ุชุชู ุฅุทูุงูุงู

### 2. Data Integrity
- โ **Foreign Key Constraints**: ุงูุชุญูู ูู ูุฌูุฏ ุงูุนูููุฉ ูุงููุฑุญูุฉ
- โ **NOT NULL Constraints**: ุงูุชุญูู ูู ุงูุญููู ุงููุทููุจุฉ
- โ **Data Types**: ุงูุชุญูู ูู ุฃููุงุน ุงูุจูุงูุงุช

### 3. Business Logic
- โ **Initial Stage Assignment**: ุชุนููู ุงููุฑุญูุฉ ุงูุฃููู ุชููุงุฆูุงู
- โ **Ticket Numbering**: ุชูููุฏ ุฑูู ูุฑูุฏ ููุชุฐูุฑุฉ
- โ **Activity Logging**: ุชุณุฌูู ูุดุงุท ุงูุฅูุดุงุก
- โ **Default Values**: ุชุทุจูู ุงูููู ุงูุงูุชุฑุงุถูุฉ

## โ๏ธ ูุดุงูู ุทูููุฉ ุชู ุงูุชุดุงููุง

### 1. ูุดููุฉ ูู ุฌูุจ ุงูุฃูุดุทุฉ
- **ุงููุตู**: ุฎุทุฃ ูู endpoint ุฌูุจ ุงูุฃูุดุทุฉ
- **ุงูุชุฃุซูุฑ**: ูุง ูุคุซุฑ ุนูู ุฅูุดุงุก ุงูุชุฐูุฑุฉ
- **ุงูุญุงูุฉ**: ูุญุชุงุฌ ูุญุต ูููุตู

### 2. ุฑุณุงุฆู ุงูุฎุทุฃ ููุจูุงูุงุช ุงูุฎุงุทุฆุฉ
- **ุงููุตู**: ุฑุณุงูุฉ "ุฎุทุฃ ูู ุงูุฎุงุฏู" ุนุงูุฉ ุฌุฏุงู
- **ุงูุชุฃุซูุฑ**: ุทููู - ุงููุธููุฉ ุชุนูู ููู ุงูุฑุณุงูุฉ ุบูุฑ ูุงุถุญุฉ
- **ุงูุญุงูุฉ**: ูููู ุชุญุณูููุง ูุงุญูุงู

## ๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### โ ุงููุชูุฌุฉ ุงูุนุงูุฉ: **ูุฌุญ ุงููุญุต ุจุงูุชูุงุฒ**

**ุนูููุฉ ุฅูุดุงุก ุงูุชุฐูุฑุฉ ุชุนูู ุจุดูู ุณููู ูุขูู:**

1. โ **ุงูุฅูุดุงุก**: ุงูุชุฐูุฑุฉ ุชููุดุฃ ุจูุฌุงุญ
2. โ **ุงูุญูุธ**: ุงูุจูุงูุงุช ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
3. โ **ุงูุชุญูู**: ุฌููุน ุงููููุฏ ูุงูุชุญููุงุช ุชุนูู
4. โ **ุงูุฃูุงู**: ุงููุตุงุฏูุฉ ูุงูุตูุงุญูุงุช ูุทููุจุฉ
5. โ **ุงูุชูุงูู**: ุงูุนูุงูุงุช ูุน ุงูุฌุฏุงูู ุงูุฃุฎุฑู ุตุญูุญุฉ
6. โ **ุงูููุทู**: ููุทู ุงูุนูู ูุทุจู ุจุดูู ุตุญูุญ

**ุงูุชูุตูุฉ**: ุงูู endpoint ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ โ

---

**ุชุงุฑูุฎ ุงููุญุต**: 2025-09-22  
**ุญุงูุฉ ุงููุธุงู**: โ ูุนูู ุจุดูู ุณููู  
**ูุณุชูู ุงูุซูุฉ**: 95% (ูุน ูุฑุงุนุงุฉ ุงููุดุงูู ุงูุทูููุฉ)
