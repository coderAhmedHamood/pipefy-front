# โ ุชูููุฐ ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุชุฐุงูุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ูุธุงู ุชุญุฏูุซ ุชููุงุฆู ููุชุฐุงูุฑ ูู ููุญุฉ Kanban ุจุงุณุชุฎุฏุงู **ุทุฑููุชูู ูุชูุงููุชูู**:

1. **WebSocket (Real-time)** - ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
2. **Auto-Refresh (Polling)** - ูุฎูุงุฑ ุงุญุชูุงุทู ูู 30 ุซุงููุฉ

---

## ๐ง ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1. Frontend - KanbanBoard Component

#### ุฃ. ุฅุถุงูุฉ Auto-Refresh Timer

```typescript
// Auto-refresh ูู 30 ุซุงููุฉ ูุฎูุงุฑ ุงุญุชูุงุทู ููุชุญุฏูุซ ุงูุชููุงุฆู
useEffect(() => {
  const refreshInterval = setInterval(async () => {
    if (!loading) {
      console.log('๐ Auto-refresh: ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู...');
      setIsAutoRefreshing(true);
      await loadTickets(true); // silent mode
      setIsAutoRefreshing(false);
    }
  }, 30000); // 30 ุซุงููุฉ

  return () => {
    clearInterval(refreshInterval);
  };
}, [process.id, visibleStageIds, loading]);
```

#### ุจ. ุชุญุณูู ุฏุงูุฉ loadTickets

```typescript
const loadTickets = async (silent = false) => {
  // ูู ุงููุถุน ุงูุตุงูุชุ ูุง ูุนุฑุถ loading spinner
  if (!silent) {
    setLoading(true);
  }
  
  // ... ุฌูุจ ุงูุจูุงูุงุช
  
  if (!silent) {
    showSuccess('ุชู ุฌูุจ ุงูุชุฐุงูุฑ', `ุชู ุฌูุจ ${response.statistics.total_tickets} ุชุฐูุฑุฉ ุจูุฌุงุญ`);
  } else {
    console.log('โ ุชู ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู:', response.statistics.total_tickets);
  }
};
```

#### ุฌ. ุฅุถุงูุฉ ูุคุดุฑ ุจุตุฑู ููุชุญุฏูุซ ุงูุชููุงุฆู

```typescript
{isAutoRefreshing && (
  <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-medium flex items-center space-x-2 space-x-reverse">
    <RefreshCw className="w-3 h-3 animate-spin" />
    <span>ุชุญุฏูุซ ุชููุงุฆู...</span>
  </span>
)}
```

### 2. Frontend - Socket Service

#### ุชุญุณููุงุช ุงูุงุชุตุงู

```typescript
this.socket = io(serverUrl, {
  auth: {
    token: token
  },
  transports: ['websocket', 'polling'],
  reconnection: true,
  reconnectionDelay: 1000,
  reconnectionDelayMax: 5000,
  reconnectionAttempts: this.maxReconnectAttempts,
  timeout: 10000
});

// ูุนุงูุฌุฉ ุฎุทุฃ ุงูุงุชุตุงู
this.socket.on('connect_error', (error) => {
  console.error('โ WebSocket connection error:', error.message);
  this.reconnectAttempts++;
  if (this.reconnectAttempts >= this.maxReconnectAttempts) {
    console.error('โ Max reconnection attempts reached');
  }
});
```

### 3. Backend - WebSocket Service

โ **ููุฌูุฏ ุจุงููุนู ููุนูู ุจุดูู ูุงูู**

- `emitTicketCreated()` - ุนูุฏ ุฅูุดุงุก ุชุฐูุฑุฉ
- `emitTicketUpdated()` - ุนูุฏ ุชุญุฏูุซ ุชุฐูุฑุฉ
- `emitTicketMoved()` - ุนูุฏ ููู ุชุฐูุฑุฉ
- `emitTicketDeleted()` - ุนูุฏ ุญุฐู ุชุฐูุฑุฉ

---

## ๐ฏ ููู ูุนูู ุงููุธุงู

### ุงูุณููุงุฑูู 1: WebSocket ูุนูู ุจุดูู ุตุญูุญ

```
1. ุงููุณุชุฎุฏู 1 ููุดุฆ ุชุฐูุฑุฉ
   โ
2. Backend ูุญูุธ ุงูุชุฐูุฑุฉ ูู DB
   โ
3. Backend ูุฑุณู ุญุฏุซ WebSocket: ticket-created
   โ
4. ุฌููุน ุงููุณุชุฎุฏููู ูุณุชูุจููู ุงูุญุฏุซ ููุฑุงู
   โ
5. Frontend ูุถูู ุงูุชุฐูุฑุฉ ุฅูู ุงูุญุงูุฉ ุงููุญููุฉ
   โ
6. โ ุงูุชุฐูุฑุฉ ุชุธูุฑ ููุฑุงู ูุฌููุน ุงููุณุชุฎุฏููู
```

### ุงูุณููุงุฑูู 2: WebSocket ูุง ูุนูู (Fallback)

```
1. ุงููุณุชุฎุฏู 1 ููุดุฆ ุชุฐูุฑุฉ
   โ
2. Backend ูุญูุธ ุงูุชุฐูุฑุฉ ูู DB
   โ
3. WebSocket ูุง ูุนูู โ
   โ
4. ุจุนุฏ 30 ุซุงููุฉ (ุฃู ุฃูู)
   โ
5. Auto-Refresh Timer ููููุฐ loadTickets(true)
   โ
6. Frontend ูุฌูุจ ุฌููุน ุงูุชุฐุงูุฑ ูู API
   โ
7. โ ุงูุชุฐูุฑุฉ ุชุธูุฑ ูููุณุชุฎุฏููู ุงูุขุฎุฑูู
```

---

## ๐ ุงูุชุญูู ูู ุนูู ุงููุธุงู

### 1. ูุชุญ Console ูู ุงููุชุตูุญ

```javascript
// ูุฌุจ ุฃู ุชุฑู:
๐ Connecting to WebSocket server: http://192.168.56.1:3004
โ WebSocket connected
๐ฅ Joining process: <process-id>
โ Joined process: <process-id>

// ูู 30 ุซุงููุฉ:
๐ Auto-refresh: ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู...
โ ุชู ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู: 15
```

### 2. ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู

#### ุงูุทุฑููุฉ 1: ุงุฎุชุจุงุฑ WebSocket
```bash
# ูู Terminal 1 - ุชุดุบูู Backend
cd api
npm start

# ูู Terminal 2 - ุชุดุบูู Frontend
npm run dev

# ูู Terminal 3 - ุฅูุดุงุก ุชุฐูุฑุฉ ุนุจุฑ API
curl -X POST "http://192.168.56.1:3004/api/tickets" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู",
    "process_id": "PROCESS_ID",
    "current_stage_id": "STAGE_ID"
  }'

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
# - ุงูุชุฐูุฑุฉ ุชุธูุฑ ููุฑุงู ูู ุงููุชุตูุญ
# - ุฑุณุงูุฉ toast: "ุชุฐูุฑุฉ ุฌุฏูุฏุฉ: ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู"
```

#### ุงูุทุฑููุฉ 2: ุงุฎุชุจุงุฑ Auto-Refresh
```bash
# 1. ุงูุชุญ ุงููุชุตูุญ ูุณุฌู ุฏุฎูู
# 2. ุงูุชุญ ููุญุฉ Kanban
# 3. ูู ูุชุตูุญ ุขุฎุฑ (ุฃู Incognito)ุ ุณุฌู ุฏุฎูู ุจูุณุชุฎุฏู ุขุฎุฑ
# 4. ุฃูุดุฆ ุชุฐูุฑุฉ ูู ุงููุณุชุฎุฏู ุงูุซุงูู
# 5. ุงูุชุธุฑ 30 ุซุงููุฉ (ุฃู ุฃูู)
# 6. โ ุงูุชุฐูุฑุฉ ุชุธูุฑ ูู ุงููุชุตูุญ ุงูุฃูู ุชููุงุฆูุงู
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุฃุฏุงุก

### ูุนุฏู ุงูุชุญุฏูุซ

- **WebSocket**: ููุฑู (< 1 ุซุงููุฉ)
- **Auto-Refresh**: ูู 30 ุซุงููุฉ

### ุงุณุชููุงู ุงูููุงุฑุฏ

- **WebSocket**: ููุฎูุถ ุฌุฏุงู (ุงุชุตุงู ูุงุญุฏ ููุชูุญ)
- **Auto-Refresh**: ููุฎูุถ (ุทูุจ API ูุงุญุฏ ูู 30 ุซุงููุฉ)

### ุงูุชูุงูู

- **WebSocket**: ูุนูู ุนูู ูุนุธู ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
- **Auto-Refresh**: ูุนูู ุนูู ุฌููุน ุงููุชุตูุญุงุช (Fallback)

---

## ๐จ ุงููุคุดุฑุงุช ุงูุจุตุฑูุฉ

### 1. ูุคุดุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู

ุนูุฏ ุชูููุฐ Auto-Refreshุ ูุธูุฑ badge ุฃุฒุฑู ูู ุฃุนูู ุงูุตูุญุฉ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุชุญุฏูุซ ุชููุงุฆู...                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ุฑุณุงุฆู Toast

ุนูุฏ ุงุณุชูุจุงู ุชุญุฏูุซุงุช WebSocket:

- **ุฅูุดุงุก ุชุฐูุฑุฉ**: "ุชุฐูุฑุฉ ุฌุฏูุฏุฉ: [ุนููุงู ุงูุชุฐูุฑุฉ]"
- **ุชุญุฏูุซ ุชุฐูุฑุฉ**: "ุชู ุงูุชุญุฏูุซ: [ุนููุงู ุงูุชุฐูุฑุฉ]"
- **ููู ุชุฐูุฑุฉ**: "ุชู ุงูููู: ุชู ููู ุงูุชุฐูุฑุฉ ุฅูู [ุงุณู ุงููุฑุญูุฉ]"
- **ุญุฐู ุชุฐูุฑุฉ**: "ุชู ุงูุญุฐู: ุชู ุญุฐู ุงูุชุฐูุฑุฉ: [ุฑูู ุงูุชุฐูุฑุฉ]"

---

## ๐ง ุงูุชุฎุตูุต

### ุชุบููุฑ ูุชุฑุฉ Auto-Refresh

ูู `KanbanBoard.tsx`:

```typescript
const refreshInterval = setInterval(async () => {
  // ...
}, 30000); // ุบููุฑ ูุฐุง ุงูุฑูู (ุจุงููููู ุซุงููุฉ)

// ุฃูุซูุฉ:
// 10000 = 10 ุซูุงูู
// 30000 = 30 ุซุงููุฉ (ุงูุงูุชุฑุงุถู)
// 60000 = 1 ุฏูููุฉ
```

### ุชุนุทูู Auto-Refresh

ุฅุฐุง ููุช ุชุฑูุฏ ุงูุงุนุชูุงุฏ ุนูู WebSocket ููุท:

```typescript
// ุงุญุฐู ุฃู ุนููู ุนูู ูุฐุง ุงูู useEffect:
/*
useEffect(() => {
  const refreshInterval = setInterval(async () => {
    // ...
  }, 30000);
  
  return () => {
    clearInterval(refreshInterval);
  };
}, [process.id, visibleStageIds, loading]);
*/
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: WebSocket ูุง ูุชุตู

**ุงูุญู:**

1. ุชุญูู ูู ุชุดุบูู Backend:
```bash
curl http://192.168.56.1:3004/api/health
```

2. ุชุญูู ูู Console:
```javascript
// ูุฌุจ ุฃู ุชุฑู:
๐ Connecting to WebSocket server: http://192.168.56.1:3004
โ WebSocket connected
```

3. ุชุญูู ูู Token:
```javascript
// ูู Console:
localStorage.getItem('auth_token')
// ุฃู
localStorage.getItem('token')
```

### ุงููุดููุฉ: Auto-Refresh ูุง ูุนูู

**ุงูุญู:**

1. ุชุญูู ูู Console:
```javascript
// ูุฌุจ ุฃู ุชุฑู ูู 30 ุซุงููุฉ:
๐ Auto-refresh: ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู...
โ ุชู ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุชููุงุฆูุงู: 15
```

2. ุชุญูู ูู ุฃู ุงููููู ูู ูููุบู ุชุญูููู:
```javascript
// ูู React DevToolsุ ุชุฃูุฏ ูู ุฃู KanbanBoard ููุฌูุฏ ูู ุงูุดุฌุฑุฉ
```

### ุงููุดููุฉ: ุงูุชุญุฏูุซุงุช ุจุทูุฆุฉ ุฌุฏุงู

**ุงูุญู:**

1. ููู ูุชุฑุฉ Auto-Refresh ุฅูู 10 ุซูุงูู:
```typescript
}, 10000); // ุจุฏูุงู ูู 30000
```

2. ุชุญูู ูู ุงุชุตุงู WebSocket:
```javascript
// ูู Console:
socketService.isConnected() // ูุฌุจ ุฃู ูุฑุฌุน true
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Auto-Refresh ูู ุงููุถุน ุงูุตุงูุช**: ูุง ูุนุฑุถ loading spinner ุฃู toast notifications ูุชุฌูุจ ุงูุฅุฒุนุงุฌ
2. **ุชุฌูุจ ุงูุชูุฑุงุฑ**: Auto-Refresh ูุง ููููุฐ ุฅุฐุง ูุงู ููุงู loading ุญุงูู
3. **ุชูุธูู ุงูููุงุฑุฏ**: ูุชู ุชูุธูู interval ุนูุฏ ุฅูุบุงุก ุชุญููู ุงููููู
4. **WebSocket ูุฃููููุฉ**: WebSocket ูู ุงูุทุฑููุฉ ุงูุฃุณุงุณูุฉุ Auto-Refresh ูู Fallback ููุท

---

## โ ุงูุฎูุงุตุฉ

ุงูุขู ูุฏูู ูุธุงู ุชุญุฏูุซ ุชููุงุฆู ูุชูุงูู ูุนูู ุจุทุฑููุชูู:

1. **WebSocket** - ููุชุญุฏูุซุงุช ุงูููุฑูุฉ (< 1 ุซุงููุฉ)
2. **Auto-Refresh** - ูุฎูุงุฑ ุงุญุชูุงุทู (ูู 30 ุซุงููุฉ)

ูุฐุง ูุถูู ุฃู ุงููุณุชุฎุฏููู ูุฑูู ุงูุชุญุฏูุซุงุช **ุฏุงุฆูุงู**ุ ุญุชู ูู ูุงู WebSocket ูุง ูุนูู.

๐ **ูู ุชุญุชุงุฌ ุจุนุฏ ุงูุขู ุฅูู ุชุญุฏูุซ ุงูุตูุญุฉ ูุฏููุงู!**

